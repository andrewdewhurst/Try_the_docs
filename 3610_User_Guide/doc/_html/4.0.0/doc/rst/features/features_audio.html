<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" /><link rel="next" title="I2C Slave Control interface (XVF3610-INT only)" href="features_interfaces.html" /><link rel="prev" title="XVF3610 Features and Configuration" href="features_booting.html" />

    <meta name="generator" content="sphinx-3.5.4, furo 2021.04.11.beta34"/>
        <title>Interfaces, Audio Routing and Filtering - XVF3610 USer Guide (V4.0.0) documentation</title>
      <link rel="stylesheet" href="../../../_static/styles/furo.css?digest=59ab60ac09ea94ccfe6deddff6d715cce948a6fc">
    <link rel="stylesheet" href="../../../_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../../../_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" href="../../../_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">XVF3610 USer Guide (V4.0.0) documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../../_static/xmos_logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">XVF3610 USer Guide (V4.0.0) documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../before_you_start.html">Before you start</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../LICENSE.html">XMOS PUBLIC LICENCE: Version 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../COPYRIGHTS.html">Copyright</a></li>
<li class="toctree-l2"><a class="reference internal" href="../version_info.html">Tool and Architecture Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../CHANGELOG.html">lib_xud Change Log</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../overview/index.html">XVF3610 Product description</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../overview/introduction.html">XVF3610 Far-field voice processor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/architecture.html">XVF3610 System Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/audio_pipeline.html">XVF3610 Voice Processing Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/control_interface.html">Principles of configuration, control and usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/firmware_package.html">Firmware release package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/firmware_package.html#required-tools">Required Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/firmware_package.html#command-line-interface-vfctrl">Command-line interface (vfctrl)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/firmware_package.html#configuration-via-control-interface">Configuration via Control interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/development_kits.html">Development kits</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Product features</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="features_booting.html">XVF3610 Features and Configuration</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Interfaces, Audio Routing and Filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="#far-field-voice-processing">Far-Field Voice Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="features_interfaces.html">I2C Slave Control interface (XVF3610-INT only)</a></li>
<li class="toctree-l2"><a class="reference internal" href="features_interfaces.html#general-purpose-input-and-output-and-peripheral-bridging">General Purpose Input and Output and Peripheral Bridging</a></li>
<li class="toctree-l2"><a class="reference internal" href="features_interfaces.html#gpio">GPIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="features_interfaces.html#i2c-master-peripheral-interface-xvf3610-ua-only">I2C Master peripheral interface (XVF3610-UA Only)</a></li>
<li class="toctree-l2"><a class="reference internal" href="features_interfaces.html#spi-master">SPI Master</a></li>
<li class="toctree-l2"><a class="reference internal" href="features_usb.html">USB Interface</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference/index.html">Reference information</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/XVF3610_parameter_summary.html">Parameter summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/Boot_Status_codes.html">Boot status codes (RUN_STATUS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/Example_SPISPEC.html">Example .SPISPEC file format</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/SPI_Booting_of_XVF3610-UA_dev_kit.html">SPI Boot custom connection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/USB_Enumeration_data.html">USB enumeration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/USB-HID_example.html">USB HID - Example using the development kit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/General_purpose_filter_example.html">General purpose filter example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/Control_parameter_protocol.html">Command transport protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/Flash_programming_flow.html">Flash programming and update flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/Capturing_packed_samples.html">Capturing packed samples for system integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/Command_table.html">Command list</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../other_resources/index.html">Additional Information</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../other_resources/documentation.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other_resources/firmware.html">Device firmware and software</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../other_resources/index.html#revision-history">Revision History</a></li>
</ul>

</div>

    <select name="version" id="version-select" value="Latest" onchange="changeVersion(this.value)" >
    <option selected disabled>Choose version</option>
            <option value="html/1.0.0/">1.0.0</option>
            <option value="html/2.0.0/">2.0.0</option>
            <option value="html/3.0.0/">3.0.0</option>
            <option value="html/latest/">latest</option>
    </select>

    <script>
    function changeVersion(val) {
        var loc = window.location.toString();
        var i = loc.indexOf("html/");
        if (i >= 0) {
            var s1 = loc.substring(0, i);
            var i2 = loc.indexOf("/", i+6)
            var s2 = loc.substring(i2+1);
            nl=s1.concat(val, s2);


            var request = new XMLHttpRequest();  
            request.open('GET', nl, true);
            request.onreadystatechange = function(){
            if (request.readyState === 4){
                if (request.status === 404) {  
                    alert("Oh no, it does not exist!");
                    window.location.assign(loc);
                    location.reload();
                }
                else {
                    window.location.assign(nl);
                }  
            }
        };
        request.send();    
        }
    }
    </script>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="interfaces-audio-routing-and-filtering">
<h1>Interfaces, Audio Routing and Filtering<a class="headerlink" href="#interfaces-audio-routing-and-filtering" title="Permalink to this headline">¶</a></h1>
<p>The Following section describes, the interfaces, audio routing and
filtering features of the XVF3610.  Each section can be referred to in
isolation, and describes all aspects relating to that feature.</p>
<div class="section" id="signal-flow-and-processing">
<h2>Signal flow and processing<a class="headerlink" href="#signal-flow-and-processing" title="Permalink to this headline">¶</a></h2>
<p>Many of the parameters and functions of the XVF3610 may be controlled
via the control interface. This control extends to being able to
configure signal routing through the pipeline itself, providing
flexibility useful in:</p>
<ul class="simple">
<li><p>Hardware testing of mics by monitoring the raw mic signal.</p></li>
<li><dl class="simple">
<dt>Improving pipeline performance by filtering known noise sources at</dt><dd><p>the raw mic input.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Monitoring and debugging of reference signals and mic signals during</dt><dd><p>development.</p>
</dd>
</dl>
</li>
<li><p>Compensating for gain offset in reference signal.</p></li>
<li><dl class="simple">
<dt>Supporting specific audio connectivity requirements such as obtaining</dt><dd><p>the reference signal from I<sup>2</sup>S.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Inserting audio filtering where a speaker is connected downstream of</dt><dd><p>the XVF3610 via I<sup>2</sup>S.</p>
</dd>
</dl>
</li>
</ul>
<p>The blocks supported are as follows:</p>
<ul class="simple">
<li><dl class="simple">
<dt>Signal Multiplexers. These allow dynamic selection (switching) of</dt><dd><p>signals. The signals available depend on the multiplexer position.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Gain Blocks. These are blocks that apply a variable bit shift (left</dt><dd><p>or right) and, in the case of left shift, saturate in the case of
overflow. Because they are shifters, the gain applied is a power
of two.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Filter Blocks. The filter blocks consist of two cascaded biquad</dt><dd><p>units. Each of the five coefficients per stage is directly
manipulated via the control utility.</p>
</dd>
</dl>
</li>
</ul>
<p>The arrangement of the blocks, with respect to the device Input &amp; Output
and the XVF3610 audio processing pipeline, is shown in Figure 4‑9 below:</p>
<div class="figure align-default" id="id1">
<img alt="../../../_images/image19.png" src="../../../_images/image19.png"/>
<p class="caption"><span class="caption-number">Fig. 10 </span><span class="caption-text">XVF3610 input, output and audio signal routing</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>The commands to control the audio multiplexes (Mux) blocks and detailed
in Table 4‑8 below and the source and destination index numbers are
listed in Table 4‑10 and Table 4‑9 respectively</p>
<div class="section" id="signal-routing-and-scaling">
<h3>Signal Routing and Scaling<a class="headerlink" href="#signal-routing-and-scaling" title="Permalink to this headline">¶</a></h3>
<p>The following controls are provided for configuring the signal control
blocks.</p>
<p>Table 4‑8 I/O Mapping Commands</p>
<div class="table-wrapper"><table class="docutils align-default">
<colgroup>
<col style="width: 25%"/>
<col style="width: 6%"/>
<col style="width: 6%"/>
<col style="width: 63%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Ty
pe</p></th>
<th class="head"><p>Ar
gs</p></th>
<th class="head"><p>Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SET_IO_MAP</p></td>
<td><p>u
in
t8</p></td>
<td><p>2</p></td>
<td><p>Configures the two input switches and
four output switches. See Destination
and Source index table for valid
argument options.</p>
<div class="line-block">
<div class="line">arg1 &lt;Destination Index&gt;</div>
<div class="line">arg2 &lt;Source Index&gt;</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>S
ET_OUTPUT_SHIFT</p></td>
<td><p>i
nt
32</p></td>
<td><p>2</p></td>
<td><p>Sets the gain for each mux block. Select
mux block Destination Index followed by
shift (+ve is left, -ve is right shift)</p>
<div class="line-block">
<div class="line">arg1 &lt;Destination Index&gt;</div>
<div class="line">arg2 &lt;shift value&gt;</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>GET_I
O_MAP_AND_SHIFT</p></td>
<td><p>ui
nt
32</p></td>
<td><p>6
x
3</p></td>
<td><p>Get all 18 IO_MAP and OUTPUT_SHIFT
values for all Destinations.</p></td>
</tr>
<tr class="row-odd"><td><p>SET_MIC
_SHIFT_SATURATE</p>
<p>GET_MIC
_SHIFT_SATURATE</p>
</td>
<td><p>ui
nt
32</p></td>
<td><p>2</p></td>
<td><p>Sets the gain on the raw mic signals
before entering the pipeline.</p>
<div class="line-block">
<div class="line">arg1 &lt;shift value (left shift)&gt;</div>
<div class="line">arg2 &lt;saturate, enable if =1&gt;</div>
</div>
</td>
</tr>
</tbody>
</table></div>
<p>Where the Destination channels available to be mapped are referenced as
follows:</p>
<p>Table 4‑9 I/O Mapping Destination Indexes</p>
<div class="table-wrapper"><table class="docutils align-default">
<colgroup>
<col style="width: 32%"/>
<col style="width: 9%"/>
<col style="width: 59%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Channel
(Destination)</p></th>
<th class="head"><p>V
alue</p></th>
<th class="head"><p>Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>USB_FROM_DEVICE_0</p></td>
<td><p>0</p></td>
<td><p>USB channel 0 output from device to
host</p></td>
</tr>
<tr class="row-odd"><td><p>USB_FROM_DEVICE_1</p></td>
<td><p>1</p></td>
<td><p>USB channel 1 output from device to
host</p></td>
</tr>
<tr class="row-even"><td><p>I2S_FROM_DEVICE_0</p></td>
<td><p>2</p></td>
<td><p>I2S channel 0 output from device</p></td>
</tr>
<tr class="row-odd"><td><p>I2S_FROM_DEVICE_1</p></td>
<td><p>3</p></td>
<td><p>I2S channel 1 output from device</p></td>
</tr>
<tr class="row-even"><td><p>REF_TO_PIPELINE_0</p></td>
<td><p>4</p></td>
<td><p>reference channel 0 going into the
pipeline</p></td>
</tr>
<tr class="row-odd"><td><p>REF_TO_PIPELINE_1</p></td>
<td><p>5</p></td>
<td><p>reference channel 1 going into the
pipeline</p></td>
</tr>
</tbody>
</table></div>
<p>Sources available to be mapped to destination are referenced as follows:</p>
<p>Table 4‑10 I/O Mapping Source Indexes</p>
<div class="table-wrapper"><table class="docutils align-default">
<colgroup>
<col style="width: 27%"/>
<col style="width: 7%"/>
<col style="width: 66%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Channel (Source)</p></th>
<th class="head"><p>Va
lue</p></th>
<th class="head"><p>Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MUTE</p></td>
<td><p>0</p></td>
<td><p>Zeros are sent to the destination if this
value is selected, which mutes the channel</p></td>
</tr>
<tr class="row-odd"><td><p>USB_T
O_DEVICE_AVERAGE</p></td>
<td><p>1</p></td>
<td><p>Average of USB input from host to device.</p></td>
</tr>
<tr class="row-even"><td><p>USB_TO_D
EVICE_DIFFERENCE</p></td>
<td><p>2</p></td>
<td><p>Half of the difference between ch0 and ch1
of USB input from host to device.</p></td>
</tr>
<tr class="row-odd"><td><p>I2S_T
O_DEVICE_AVERAGE</p></td>
<td><p>3</p></td>
<td><p>Average of I2S input to device.</p></td>
</tr>
<tr class="row-even"><td><p>I2S_TO_D
EVICE_DIFFERENCE</p></td>
<td><p>4</p></td>
<td><p>Half of the difference between ch0 and ch1
of I2S input to device.</p></td>
</tr>
<tr class="row-odd"><td><p>PIPELINE_OUT_0</p></td>
<td><p>5</p></td>
<td><p>Pipeline output channel 0</p></td>
</tr>
<tr class="row-even"><td><p>PIPELINE_OUT_1</p></td>
<td><p>6</p></td>
<td><p>Pipeline output channel 1</p></td>
</tr>
<tr class="row-odd"><td><p>USB_TO_DEVICE_0</p></td>
<td><p>7</p></td>
<td><p>USB input channel 0 from host to device</p></td>
</tr>
<tr class="row-even"><td><p>USB_TO_DEVICE_1</p></td>
<td><p>8</p></td>
<td><p>USB input channel 1 from host to device</p></td>
</tr>
<tr class="row-odd"><td><p>I2S_TO_DEVICE_0</p></td>
<td><p>9</p></td>
<td><p>I2S input channel 0 to device</p></td>
</tr>
<tr class="row-even"><td><p>I2S_TO_DEVICE_1</p></td>
<td><p>10</p></td>
<td><p>I2S input channel 1 to device</p></td>
</tr>
<tr class="row-odd"><td><p>MIC_IN_0</p></td>
<td><p>11</p></td>
<td><p>Ch0 Microphone input seen by the pipeline</p></td>
</tr>
<tr class="row-even"><td><p>MIC_IN_1</p></td>
<td><p>12</p></td>
<td><p>Ch1 Microphone input seen by the pipeline</p></td>
</tr>
<tr class="row-odd"><td><p>PACKED
_PIPELINE_OUTPUT</p></td>
<td><p>13</p></td>
<td><p>pack 16kHz pipeline output on 48kHz output
(See Appendix J: Capturing packed samples
for system integration for further
information)</p></td>
</tr>
<tr class="row-even"><td><p>PACKED_MIC</p></td>
<td><p>14</p></td>
<td><p>pack 16kHz mic input to pipeline on 48kHz
output (See Appendix J):</p></td>
</tr>
<tr class="row-odd"><td><p>PACKED_REF</p></td>
<td><p>15</p></td>
<td><p>pack 16kHz reference input to pipeline on
48kHz output (See Appendix J)</p></td>
</tr>
<tr class="row-even"><td><p>PACKED_ALL</p></td>
<td><p>16</p></td>
<td><p>pack 1 channel of 16kHz mic, reference
input and pipeline. When this option is
used, the other channel of the same output
also gets PACKED_ALL set in its IO map.
(See Appendix J: Capturing packed samples
for system integration for further
information)</p></td>
</tr>
</tbody>
</table></div>
<p>NOTE: The MIC_IN_0 and MIC_IN_1 signals are at 16kHz. If they are routed
to a 48kHz output they will be sample repeated three times. No
antialiasing filter is applied.</p>
<p>The following section illustrates how to use the IO mapping and scaling
commands.</p>
<p>Using the SET_IO_MAP command, the user can choose the sources that get
routed to the following 3 destinations -</p>
<ul class="simple">
<li><p>the USB output from device to host</p></li>
<li><p>the I2S output from the device</p></li>
<li><p>the reference going into the device</p></li>
</ul>
<p>For instance, to route I2S channel 0 (= 9 as shown in the Source table)
input to the device to USB channel 1 output from the device ( = 1 as
shown in the destination table), the command is:</p>
<p>vfctrl_usb SET_IO_MAP 1 9</p>
<p>where the first argument “1” refers to USB_FROM_DEVICE_1 as shown in the
destination table and the second argument “9” refers to I2S_TO_DEVICE_0
in the source table.</p>
<p>Signal routing is also useful for hardware debugging of microphone or
reference signal connection. As an example, the following command routes
USB reference channel 0 from host to the USB audio output channel 0 of
XVF3610:</p>
<p>vfctrl_usb SET_IO_MAP 0 7</p>
<p>A loopback of reference signal input XVF3610 and its audio output is
formed. By playing back signal, e.g. a sine wave as the reference signal
output from host, the user can verify if the signal is being received
properly by XVF3610 through its audio output. If the audio signal
recorded at host is different from the reference output, the user may
check if the problem is caused by hardware connection failure or wrong
data format.</p>
<p>Signal routing can also be used for debugging microphone signal:</p>
<p>vfctrl_usb SET_IO_MAP 1 12</p>
<p>The above command routes microphone channel 1 as the direct signal to
XVF3610’s USB audio output. Microphone signals can the be verified by
recording XVF3610’s audio output.</p>
<p>For XVF3610-UA, its I<sup>2</sup>S master interface can be used for
sending out different kind of signal shown in the source channel table
while having USB outputs of processed audio. For example, the following
command configures to send channels of mic, reference and pipeline
outputs in 16kHz sampling frequency packed to 48kHz I<sup>2</sup>S
output:</p>
<p>vfctrl_usb SET_IO_MAP 2 16</p>
<p>vfctrl_usb SET_IO_MAP 3 16</p>
<p>By using Raspberry Pi with I<sup>2</sup>S slave interface configured,
the user can then capture synchronized signals of mic, reference and
pipeline output. Observing these signals can be very useful for
debugging. The packed signal can be unpacked to mic, reference and
pipeline signal with 2 channels in each of them by using a Python script
provided in the Release Package.</p>
<p>The SET_OUTPUT_SHIFT command can be used to specify a bit shift that is
applied to all samples of a given target. For example, specifying:</p>
<p>vfctrl_usb SET_OUTPUT_SHIFT 2 4</p>
<p>applies a left shift of 4 bits on all samples output from the device on
I2S channel 0 as 2<sup>4</sup>=16x of gain. A negative shift value would
imply a right bit shift for attenuation.</p>
<p>The GET_IO_MAP_AND_SHIFT command displays the IO mapping and the shift
values for all targets.</p>
<p>Executing a GET_IO_MAP_AND_SHIFT command without having set any mapping
or shifts explicitly shows the default mapping that is configured in
firmware.</p>
<p>vfctrl_usb GET_IO_MAP_AND_SHIFT</p>
<p>GET_IO_MAP_AND_SHIFT:</p>
<p>target: USB_FROM_DEVICE_0, source: PIPELINE_OUT_0 output shift: NONE</p>
<p>target: USB_FROM_DEVICE_1, source: PIPELINE_OUT_1 output shift: NONE</p>
<p>target: I2S_FROM_DEVICE_0, source: PIPELINE_OUT_0 output shift: NONE</p>
<p>target: I2S_FROM_DEVICE_1, source: FAR_END_IN_0 output shift: NONE</p>
<p>target: REF_TO_PIPELINE_0, source: USB_TO_DEVICE_0 output shift: NONE</p>
<p>target: REF_TO_PIPELINE_1, source: USB_TO_DEVICE_1 output shift: NONE</p>
</div>
<div class="section" id="general-purpose-filter">
<h3>General Purpose Filter<a class="headerlink" href="#general-purpose-filter" title="Permalink to this headline">¶</a></h3>
<p>The General Purpose filter blocks each comprise of two cascade biquad
filters permitting configuration as bandpass, notch, low-pass, high-pass
filters etc. By default, all filters are disabled (bypassed).</p>
<p>NOTE: A maximum of two output filters may be enabled simultaneously. Eg.
Two channels of USB filtering or one I2S and one USB output. Exceeding
this may cause audio glitching.</p>
<p>There is no restriction on input filters (mic and reference filters).</p>
<p>The filter coefficients are accepted in a floating-point format in a1,
a2, b0, b1, b2 order directly from filter design tools such as
<a class="reference external" href="https://arachnoid.com/BiQuadDesigner/index.html">https://arachnoid.com/BiQuadDesigner/index.html</a>.</p>
<p>Support for the raw 32bit integer write/read is offered which directly
accesses the internal representation. When using the raw control method,
coefficients should be converted to Q28.4 format first and a<sub>1</sub>
and a<sub>2</sub> need to be negated. See configuration parameters for
more information.</p>
<p>The sample rate for filters on the input to the pipeline are always
16kHz whereas the output filters match the selected rate which may be
either 16kHz or 48kHz, depending on system configuration. Ensure that
the filter coefficients have been designed with the correct rate.</p>
<p>Note that, although potential numerical overflows are handled as a
saturation, it is up to the designer to ensure no saturation occurs from
the coefficients chosen to avoid non-linear behaviour of the filter. The
implementation offers three bits of headroom (Q28.4) which is more than
sufficient for most filters.</p>
<p>The coefficients are cleared to zero on boot.</p>
<p>The following table describes the commands for the configuration of the
filters.</p>
<p>Table 4‑11 Filter configuration parameters</p>
<div class="table-wrapper"><table class="docutils align-default">
<colgroup>
<col style="width: 22%"/>
<col style="width: 6%"/>
<col style="width: 15%"/>
<col style="width: 57%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Ty
pe</p></th>
<th class="head"><p>A
rguments</p></th>
<th class="head"><p>Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SET
_FILTER_INDEX</p></td>
<td><p>u
in
t8</p></td>
<td><p>1</p></td>
<td><p>Used as an index to point to which
filter block that will be
manipulated. output_filter_map_t
below defines the filter block IDs.</p></td>
</tr>
<tr class="row-odd"><td><p>GET
_FILTER_INDEX</p></td>
<td><p>u
in
t8</p></td>
<td><p>1</p></td>
<td><p>Retrieve the current filter index.</p></td>
</tr>
<tr class="row-even"><td><p>SET_FITER
_BYPASS</p></td>
<td><p>u
in
t8</p></td>
<td><p>1</p></td>
<td><p>Bypass (1) means filter pointed to
by the index is not enabled
(default), 0 means enable the
filter.</p></td>
</tr>
<tr class="row-odd"><td><p>GET_FILTER
_BYPASS</p></td>
<td><p>u
in
t8</p></td>
<td><p>1</p></td>
<td><p>Retrieve the bypass status.</p></td>
</tr>
<tr class="row-even"><td><p>SET
_FILTER_COEFF</p></td>
<td><p>f
lo
at</p></td>
<td><p>10 (5x2)</p></td>
<td><p>Set 5 x 2 biquad coefficients in a
floating-point format in the order
a1, a2, b0, b1, b2. Coefficient a0
is assumed to be 1.0. If it is not,
divide all coefficients by a0.</p></td>
</tr>
<tr class="row-odd"><td><p>GET
_FILTER_COEFF</p></td>
<td><p>f
lo
at</p></td>
<td><p>10 (5x2)</p></td>
<td><p>Retrieve the floating-point
representation of the coefficients
in the order a1, a2, b0, b1, b2.</p></td>
</tr>
<tr class="row-even"><td><p>SET_FIL
TER_COEFF_RAW</p></td>
<td><p>i
nt
32</p></td>
<td><p>10 (5x2)</p></td>
<td><p>Set 5 x 2 biquad coefficients in
Q28.4 format for the filter pointed
to by the index. See note above in
Filter Blocks section about the
format.</p></td>
</tr>
<tr class="row-odd"><td><p>GET_FIL
TER_COEFF_RAW</p></td>
<td><p>i
nt
32</p></td>
<td><p>10 (5x2)</p></td>
<td><p>Retrieve the Q28.4 representation of
the coefficients. See note above in
Filter Blocks section about the
format.</p></td>
</tr>
</tbody>
</table></div>
<p>Filter output indexes available to be used with filter setting commands
(output_filter_map_t):</p>
<div class="table-wrapper"><table class="docutils align-default">
<colgroup>
<col style="width: 33%"/>
<col style="width: 7%"/>
<col style="width: 60%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Channel</p></th>
<th class="head"><p>Va
lue</p></th>
<th class="head"><p>Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>FILT
ER_USB_FROM_DEVICE_0</p></td>
<td><p>0</p></td>
<td><p>USB channel 0 from device to host
(Left)</p></td>
</tr>
<tr class="row-odd"><td><p>FILT
ER_USB_FROM_DEVICE_1</p></td>
<td><p>1</p></td>
<td><p>USB channel 1 from device to host
(Right)</p></td>
</tr>
<tr class="row-even"><td><p>FILT
ER_I2S_FROM_DEVICE_0</p></td>
<td><p>2</p></td>
<td><p>I2S channel 0 from device (Left)</p></td>
</tr>
<tr class="row-odd"><td><p>FILT
ER_I2S_FROM_DEVICE_1</p></td>
<td><p>3</p></td>
<td><p>I2S channel 1 output from device
(Right)</p></td>
</tr>
<tr class="row-even"><td><p>FILT
ER_MIC_TO_PIPELINE_0</p></td>
<td><p>4</p></td>
<td><p>16kHz mic channel 0 going into the
pipeline</p></td>
</tr>
<tr class="row-odd"><td><p>FILT
ER_MIC_TO_PIPELINE_1</p></td>
<td><p>5</p></td>
<td><p>16kHz mic channel 1 going into the
pipeline</p></td>
</tr>
<tr class="row-even"><td><p>FILT
ER_REF_TO_PIPELINE_1</p></td>
<td><p>6</p></td>
<td><p>16kHz reference channel 0 going into
the pipeline (Left)</p></td>
</tr>
<tr class="row-odd"><td><p>FILT
ER_REF_TO_PIPELINE_1</p></td>
<td><p>7</p></td>
<td><p>16kHz reference channel 1 going into
the pipeline (Right)</p></td>
</tr>
</tbody>
</table></div>
<p>While setting the index or bypass control will always be safe, there is
a small chance that the coefficients may be partially updated halfway
through a filter operation. For this reason, the filter state is also
cleared following updating to ensure that any possibility of instability
is reduced. It is up to the user to ensure that the coefficients
provided result in a stable filter configuration.</p>
<p>See Appendix G for a worked example on filter definition.</p>
</div>
</div>
</div>
<div class="section" id="far-field-voice-processing">
<h1>Far-Field Voice Processing<a class="headerlink" href="#far-field-voice-processing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="pdm-microphone-interface">
<h2>PDM microphone interface<a class="headerlink" href="#pdm-microphone-interface" title="Permalink to this headline">¶</a></h2>
<p>The PDM microphone interface converts Pulse Density Modulation (PDM)
audio input from the microphones to Pulse Code Modulation (PCM) format
allowing further processing. The PDM microphone interface consists of
the physical pins connecting to the two microphones and a series of
filters resulting in a 16kHz PCM, two-channel output stream suitable for
far-field voice processing. Please refer to the datasheet for the
physical and electrical details of the PDM pins.</p>
<p>The processing consists of four filter stages:</p>
<ul class="simple">
<li><p>Decimate by 8 FIR filter to 384kHz</p></li>
<li><p>Decimate by 4 FIR filter to 96kHz</p></li>
<li><p>Decimate by 6 FIR filter to 16kHz</p></li>
<li><p>DC Blocking, single-pole IIR filter</p></li>
</ul>
<div class="figure align-default" id="id2">
<img alt="../../../_images/image20.png" src="../../../_images/image20.png"/>
<p class="caption"><span class="caption-number">Fig. 11 </span><span class="caption-text">PDM microphone processing steps</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>The PDM microphone interface uses 32-bit internal processing to provide
very low distortion with a specification exceeding -110dB THD+N with a
140dB dynamic range.</p>
<p>The frequency response of the FIR filter has a stopband attenuation of
at least 70dB with a passband ripple of less than 0.9dB and a passband
of 6.8kHz. The total group delay from pin to the XVF3610 audio pipeline
input is 1.125 milliseconds.</p>
<p>A DC blocking filter is placed at the end of the PDM microphone
interface pipeline and is tuned to have a 5Hz -6dB point and removes any
DC offset present in the PDM input.</p>
<p>The output from the PDM microphone interface may optionally be shifted
or attenuated providing a ‘power of two’ gain control. Saturation may be
applied in the case that the gain is greater than one.</p>
<p>By default, the gain block shift is set to zero (a gain of 2<sup>0</sup> =
1) and this is the recommended setting for normal use.</p>
<p>The PDM interface control parameters are shown below:</p>
<p>Table 4‑12 Microphone commands</p>
<div class="table-wrapper"><table class="docutils align-default">
<colgroup>
<col style="width: 33%"/>
<col style="width: 6%"/>
<col style="width: 17%"/>
<col style="width: 38%"/>
<col style="width: 6%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Ty
pe</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>N
ot
es</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SET
_MIC_SHIFT_SATURATE</p></td>
<td><p>ui
nt
32</p></td>
<td><p>arg1
&lt;shift
value
(left
shift)&gt;
arg2
&lt;
saturate,
enable if
!=0&gt;</p></td>
<td><p>Write the gain (power
of 2) on the raw mic
signals before
entering the audio
pipeline.</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>GET
_MIC_SHIFT_SATURATE</p></td>
<td><p>ui
nt
32</p></td>
<td></td>
<td><p>Read the gain (power
of 2) on the raw mic
and Saturate Enable
signals before
entering the audio
pipeline.</p></td>
<td></td>
</tr>
</tbody>
</table></div>
</div>
<div class="section" id="automatic-echo-cancellation-aec">
<h2>Automatic Echo Cancellation (AEC)<a class="headerlink" href="#automatic-echo-cancellation-aec" title="Permalink to this headline">¶</a></h2>
<p>This process uses the stereo audio from the product as a reference
signal to model the echo characteristics between each loudspeaker and
microphone, caused by the acoustic environment of the device and room.</p>
<p>The AEC uses four models to continuously remove echoes in the microphone
audio input created in the room by the loudspeakers. The models
continually adapt to the acoustic environment to accommodate changes in
the room created by events such as doors opening or closing and people
moving about.</p>
<p>An illustration of echo paths in two sizes of room are shown below.</p>
<div class="figure align-default" id="id3">
<img alt="../../../_images/image21.png" src="../../../_images/image21.png"/>
<p class="caption"><span class="caption-number">Fig. 12 </span><span class="caption-text">Echo paths from the speakers to the microphones</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<p>After reset, or when echo paths change due to a change in the
environment, the AEC will re-converge. Echo Return Loss Enhancement
(ERLE) can be used to indicate the degree of convergence on the AEC
filters as shown below.</p>
<div class="figure align-default" id="id4">
<img alt="../../../_images/image22.png" src="../../../_images/image22.png"/>
<p class="caption"><span class="caption-number">Fig. 13 </span><span class="caption-text">Settling time of the AEC shown using an ERLE plot</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<p>For optimal AEC settling-time performance, the volume of the speakers
must be linearly proportional to the level of the reference audio sent
to the XVF3610. If the volume of the speakers change without the level
of the reference changing by the same linear factor, the AEC will
respond as if the environment has changed such that all echo paths have
increased/decreased energy, and will therefore incur a settling time in
the AEC.</p>
<p>The Alternative Architecture (described in the <em>Alternative Architecture
mode (ALT_ARCH)</em> section<em>)</em> selectively extends the AEC filters to
accommodate highly reverberant environments.</p>
<p>The configuration parameters for the AEC are shown below:</p>
<p>Table 4‑13 Useful Automatic Echo Canceller (AEC) commands</p>
<div class="table-wrapper"><table class="docutils align-default">
<colgroup>
<col style="width: 33%"/>
<col style="width: 6%"/>
<col style="width: 17%"/>
<col style="width: 34%"/>
<col style="width: 9%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Ty
pe</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>N
otes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>GET_BYPASS_AEC</p>
<p>SET_BYPASS_AEC</p>
</td>
<td><p>ui
nt
32</p></td>
<td><p>[0,1]</p>
<p>0 = AEC
bypass
disabled
(default)</p>
<p>1 = AEC
bypass
enabled</p>
</td>
<td><p>Get/Set AEC bypass
parameter. If set to
one, AEC processing
is disabled.</p></td>
<td><p>A</p></td>
</tr>
<tr class="row-odd"><td><p>SET_AD
APTATION_CONFIG_AEC</p>
<p>GET_AD
APTATION_CONFIG_AEC</p>
</td>
<td><p>ui
nt
32</p></td>
<td><p>[0, 1, 2]</p>
<p>0 = Auto
adapt
(default)</p>
<p>1 = Force
a
daptation
ON</p>
<p>2 = Force
a
daptation
OFF</p>
</td>
<td><p>Sets AEC adaptation
configuration. If
AEC is set to bypass
then setting the
adaptation config
has no effect.</p></td>
<td><p>B</p></td>
</tr>
<tr class="row-even"><td><p>GET_ERLE_CH0_AEC</p></td>
<td><p>f
lo
at</p></td>
<td></td>
<td><p>Get AEC ERLE for
channel 0</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>GET_ERLE_CH1_AEC</p></td>
<td><p>f
lo
at</p></td>
<td></td>
<td><p>Get AEC ERLE for
channel 1</p></td>
<td><p>C</p></td>
</tr>
<tr class="row-even"><td><p>RESET_FILTER_AEC</p></td>
<td></td>
<td></td>
<td><p>This command resets
all AEC filters.</p></td>
<td></td>
</tr>
</tbody>
</table></div>
<p><strong>[A]</strong> When the Alternative Architecture (ALT_ARCH) mode is enabled
(default), AEC bypass state will be overwritten and so should not be
used. The GET command remains functional. For more information see the
<em>Alternative Architecture</em> <em>(ALT_ARCH)</em> section.</p>
<p><strong>[B]</strong> If Automatic Delay Estimation is enabled, these parameters will
be overwritten and so should not be used. The GET commands remain
functional. For more information see the <em>Automatic Delay Estimation &amp;
Correction (ADEC)</em> section.</p>
<p><strong>[C]</strong> When the ALT_ARCH mode is enabled, there is only valid ERLE data
available on CH0. In this mode the GET_ERLE_CH1_AEC will report NaN.</p>
<p>NOTE: The AEC operates on acoustic paths modelled in the AEC tail
length. The Automatic Delay Estimation and Correction module handles
delays between microphone and loudspeaker introduced by the equipment,
for instance receiving the reference ahead of it actually being played
out of the loudspeakers.</p>
</div>
<div class="section" id="automatic-delay-estimation-correction-adec">
<h2>Automatic Delay Estimation &amp; Correction (ADEC)<a class="headerlink" href="#automatic-delay-estimation-correction-adec" title="Permalink to this headline">¶</a></h2>
<p>The ADEC module automatically corrects for possible delay offsets
between the reference and the loudspeakers.</p>
<p>Echo cancellation is an adaptive filtering process which compares the
reference audio to that received from the microphones. It models the
reverberant time of a room, i.e. the time it takes for acoustic
reflections to decay to insignificance. This is shown in the figure
below (the red “Acoustic echo path delay”).</p>
<p>The time window modelled by the AEC is finite, and to maximise its
performance it is important to ensure that the reference audio is
presented to the AEC time aligned to the audio being reproduced by the
loudspeakers. The diagram below highlights how the reference audio path
delay and the audio reproduction path may be significantly different,
therefore requiring additional delay to be inserted into one of the two
paths, correcting this delay difference.</p>
<div class="figure align-default" id="id5">
<img alt="../../../_images/image23.png" src="../../../_images/image23.png"/>
<p class="caption"><span class="caption-number">Fig. 14 </span><span class="caption-text">ADEC use case diagram</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
<p>The functional blocks in the ADEC are shown below:</p>
<div class="figure align-default" id="id6">
<img alt="../../../_images/image24.png" src="../../../_images/image24.png"/>
<p class="caption"><span class="caption-number">Fig. 15 </span><span class="caption-text">ADEC block diagram</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</div>
<p>Delay corrections may be applied to either microphone or reference path,
to cope with reference or loudspeaker being ahead of the other,
accomplished by switching the delay into either the microphone channel
or the reference channel.</p>
<p>Automatic delay estimation is triggered at power-up, or if the host
system configuration changes. The process will not begin until the
reference signal is present and has sufficient energy.</p>
<p>The delay estimation process supports two stages:</p>
<ul class="simple">
<li><dl class="simple">
<dt>Fine delay estimation, during which AEC adaption is paused. Fine</dt><dd><p>delay estimation searches over a limited delay window to detect
small changes in delay. If the delay correction is not resolved
the coarse estimation is triggered.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Coarse delay estimation, re-purposes the AEC to detect larger delays.</dt><dd><p>During estimation, the AEC does not perform cancellation. Once the
delay is detected, and delay correction made the AEC restarts and
converges based on the delayed signals.</p>
</dd>
</dl>
</li>
</ul>
<p>Possible causes that may trigger coarse estimation:</p>
<ul class="simple">
<li><dl class="simple">
<dt>Device reset (if initial delay estimation is enabled, default:</dt><dd><p>enabled)</p>
</dd>
</dl>
</li>
<li><p>Host changing applications</p></li>
<li><dl class="simple">
<dt>Large volume changes between the reference and the loudspeaker</dt><dd><p>play-back</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>User equipment changes, such as switching from TV audio output to</dt><dd><p>playing the audio through a soundbar</p>
</dd>
</dl>
</li>
</ul>
<p>Possible causes that may trigger fine estimation:</p>
<ul class="simple">
<li><dl class="simple">
<dt>Host toggling between audio devices (such as using a voice assistant</dt><dd><p>application and listening to music at the same time) This is
typically only seen in USB configurations</p>
</dd>
</dl>
</li>
<li><p>Host processor performance leading to poor USB buffer management</p></li>
</ul>
<p>The characteristics and specification of the ADEC function is shown
below:</p>
<p>Table 4‑14 ADEC characteristics</p>
<div class="table-wrapper"><table class="docutils align-default">
<colgroup>
<col style="width: 13%"/>
<col style="width: 27%"/>
<col style="width: 60%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Maximum
delay
cor
rection</p></td>
<td><p>± 150ms</p></td>
<td><p>The maximum delay that can be added to
either the microphone channel or the
reference channel.</p></td>
</tr>
<tr class="row-odd"><td><p>Coarse
est
imation
time</p></td>
<td><p>With good
reference SNR:
2-5 seconds</p></td>
<td><p>During this time AEC is disabled. Note
that estimation will not start unless
reference is available and
loudspeakers are playing back.</p></td>
</tr>
<tr class="row-even"><td><p>Fine
est
imation
time</p></td>
<td><p>&lt;1 second.</p>
<p>If fine-grain
estimation
fails,
coarse-grain
estimation is
triggered.</p>
</td>
<td><p>During this time adaptation in the AEC
is disabled. Note that estimation will
not start unless reference is
available and loudspeakers are playing
back.</p></td>
</tr>
</tbody>
</table></div>
<p>The configuration commands are shown below:</p>
<p>Table 4‑15 Automatic Delay Estimator parameters</p>
<div class="table-wrapper"><table class="docutils align-default">
<colgroup>
<col style="width: 33%"/>
<col style="width: 6%"/>
<col style="width: 17%"/>
<col style="width: 38%"/>
<col style="width: 6%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Ty
pe</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>N
ot
es</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>GET_DELAY_SAMPLES</p>
<p>SET_DELAY_SAMPLES</p>
</td>
<td><p>ui
nt
32</p></td>
<td><p>[0 ..
2399]</p></td>
<td><p>Change the number of
samples of input delay
at the sample rate
16kHz.</p>
<div class="line-block">
<div class="line">The delay is applied
to either the</div>
<div class="line">reference or the
microphone in</div>
<div class="line">put according to the
delay direction.</div>
</div>
<p>This provides a
maximum delay of +/-
150mS.</p>
</td>
<td><p>A</p></td>
</tr>
<tr class="row-odd"><td><p>GET_DELAY_DIRECTION</p>
<p>SET_DELAY_DIRECTION</p>
</td>
<td><p>ui
nt
32</p></td>
<td><p>[0,1]</p>
<p>0 -
Delay
the
reference
input
(default)</p>
<p>1 -
Delay
the
microphone
input</p>
</td>
<td><p>Select the direction
of input delay.</p>
<p>i.e. it is applied to
either the microphone
input path or the
reference signal path.</p>
</td>
<td><p>A</p></td>
</tr>
<tr class="row-even"><td><p>GET_DELAY_ESTIMATE</p></td>
<td><p>ui
nt
32</p></td>
<td><p>[0 ..
7200]</p></td>
<td><p>Get an estimate of the
number of samples of
delay on the reference
input at a sample rate
of 16kHz. This value
is valid only when a
coarse-grain delay
estimation is in
progress, and is
offset by the maximum
length of the delay
buffer (2400 samples).
Add 2400 samples to
this value to get the
absolute delay
estimate.</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>SET_ADEC_ENABLED</p>
<p>GET_ADEC_ENABLED</p>
</td>
<td><p>ui
nt
32</p></td>
<td><p>[0, 1]</p>
<p>0 - ADEC
disabled</p>
<p>1 - ADEC
enabled</p>
</td>
<td><p>Enable automatic
coarse-grain delay
control.</p>
<p>If automatic
fine-grain delay
control is enabled
(SET_LOCKER_ENABLED
1), this parameter is
overridden by a state
machine internal to
the firmware.</p>
</td>
<td></td>
</tr>
<tr class="row-even"><td><p>GET_ADEC_MODE</p></td>
<td><p>ui
nt
32</p></td>
<td><p>[0,1]</p>
<p>0 -
Normal
AEC mode</p>
<p>1 - delay
e
stimation
in
progress</p>
</td>
<td><p>Get the status of
coarse-grain delay
estimation.</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>SET_MANUAL
_ADEC_CYCLE_TRIGGER</p></td>
<td><p>ui
nt
32</p></td>
<td></td>
<td><p>Trigger a delay
estimation cycle.</p>
<p>The default behaviour
in firmware is to
trigger a coarse-grain
delay estimation cycle
when the far end
reference is detected
for the first time
after device reset.
This is done
irrespective of
whether automatic
coarse-grain delay
control is enabled or
disabled. To disable
this initial delay
estimation, set
SET_MANUA
L_ADEC_CYCLE_TRIGGER=0
in the data partition.</p>
<p>For all other times,
if coarse-grain delay
estimation is
disabled, the
SET_MAN
UAL_ADEC_CYCLE_TRIGGER
can be used to force a
coarse-grain delay
estimation cycle.</p>
</td>
<td></td>
</tr>
<tr class="row-even"><td><p>GET_AEC_PE
AK_TO_AVERAGE_RATIO</p></td>
<td><p>f
lo
at</p></td>
<td></td>
<td><p>Get current AEC filter
coefficients peak to
average ratio. If this
value is above 4, the
AEC has a “good” peak
to average ratio.</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>SET_LOCKER_ENABLED</p>
<p>GET_LOCKER_ENABLED</p>
</td>
<td><p>ui
nt
32</p></td>
<td><p>[0,1]</p>
<p>0 -
Automatic
f
ine-grain
delay
control
disabled</p>
<p>1 -
Automatic
f
ine-grain
delay
control
enabled</p>
</td>
<td><p>Enable automatic
fine-grain delay
control. If enabled,
the fine-grain delay
control state machine
overrides the setting
for automatic
coarse-grain delay
control, so the
SET_ADEC_ENABLED
control command
shouldn’t be used.</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>SET_LOCKER_DEL
AY_SETPOINT_ENABLED</p>
<p>GET_LOCKER_DEL
AY_SETPOINT_ENABLED</p>
</td>
<td><p>ui
nt
32</p></td>
<td><p>[0,1]</p>
<p>0 - delay
setpoint
disabled
(default)</p>
<p>1 - delay
setpoint
enabled</p>
</td>
<td><p>Set the delay setpoint
enabled flag. When
enabled, if the
fine-grain delay
estimator is unable to
find the correct
delay, then instead of
triggering a
coarse-grain delay
estimate it sets the
delay to a user
defined value. This
can reduce recovery
time after a delay
change.</p>
<p>Before setting
SET_LOCKER_DELAY
_SETPOINT_ENABLED
to 1, make sure that
the delay value and
direction are set
using
SET_LOCKER_DELAY
_SETPOINT_SAMPLES
and
SET_LOCKER_DE
LAY_SETPOINT_DIRECTION
commands</p>
</td>
<td></td>
</tr>
<tr class="row-odd"><td><p>SET_LOCKER_DEL
AY_SETPOINT_SAMPLES</p>
<p>GET_LOCKER_DEL
AY_SETPOINT_SAMPLES</p>
</td>
<td><p>ui
nt
32</p></td>
<td><p>default:
0</p></td>
<td><p>Set the number of
samples of delay that
the automatic
fine-grain delay
control sets if
SET_LOCKER_DELAY
_SETPOINT_ENABLED
is set to 1, and the
fine-grain estimator
fails to converge to a
delay.</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>SET_LOCKER_DELAY
_SETPOINT_DIRECTION</p>
<p>GET_LOCKER_DELAY
_SETPOINT_DIRECTION</p>
</td>
<td><p>ui
nt
32</p></td>
<td><p>[0,1]</p>
<p>0 - delay
the
Reference
input
(default)</p>
<p>1 - delay
the Mic
input</p>
</td>
<td><p>Set the direction of
input delay that the
automatic fine-grain
delay control sets if
SET_LOCKER_DELAY
DELAY_SETPOINT_ENABLED
is set to 1, and the
fine-grain estimator
fails to converge to a
delay.</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>GET_LOCKER_STATE</p></td>
<td><p>s
tr</p></td>
<td><p>“B
OTH_WAIT”</p>
<p>“LOCKE
R_SEARCH”</p>
<p>“ADEC_T
RIGGERED”</p>
<p>“
DELAY_PRO
PAGATING”</p>
</td>
<td><p>Get the current state
of automatic
fine-grain delay
control state machine.</p></td>
<td></td>
</tr>
</tbody>
</table></div>
<p><strong>[A]</strong> When either of automatic coarse-grain or fine-grain delay
control systems are enabled, this value will be overwritten, therefore
the SET commands should not be used. GET commands remain valid.</p>
</div>
<div class="section" id="interference-canceller">
<h2>Interference canceller<a class="headerlink" href="#interference-canceller" title="Permalink to this headline">¶</a></h2>
<p>The Interference Canceller (IC) suppresses static noise from point
sources such as cooker hoods, washing machines, or radios for which
there is no reference audio signal available. When an internal Voice
Activity Detector (VAD) indicates the absence of voice, the IC adapts to
remove noise from point sources in the environment. When the VAD detects
voice, the IC suspends adaptation which maintains suppression of the
interfering noise sources previously adapted to.</p>
<p>The IC only operates on the ASR channel from the pipeline output. The
communications output channel optionally has a beamformer which fixes a
region of interest directly in front, perpendicular to the plane of the
two microphones.</p>
<p>The following table describes the configuration parameters for the
Interference Canceller.</p>
<p>Table 4‑16 Interference Canceller (IC) parameter</p>
<div class="table-wrapper"><table class="docutils align-default">
<colgroup>
<col style="width: 33%"/>
<col style="width: 6%"/>
<col style="width: 17%"/>
<col style="width: 38%"/>
<col style="width: 6%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Ty
pe</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>N
ot
es</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SET_BYPASS_IC</p>
<p>GET_BYPASS_IC</p>
</td>
<td><p>ui
nt
32</p></td>
<td><p>[0,1]</p>
<p>0 = IC
bypass
disabled
(default)</p>
<p>1 = IC
bypass
enabled</p>
</td>
<td><p>Set IC bypass
parameter. If set
to one, IC processing
is bypassed.</p></td>
<td><p>A</p></td>
</tr>
<tr class="row-odd"><td><p>SET_CH1
_BEAMFORM_ENABLE</p>
<p>GET_CH1
_BEAMFORM_ENABLE</p>
</td>
<td><p>ui
nt
32</p></td>
<td><p>[0,1]</p>
<p>0 =
Pa
ssthrough
IC input
channel 1
onto IC
output
channel 1</p>
<p>1 =
B
eamformed
output on
IC output
channel 1
(default)</p>
</td>
<td><p>Enable beamformed
output on IC output
channel index 1.</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>RESET_FILTER_IC</p></td>
<td></td>
<td></td>
<td><p>This command resets
the IC filter.</p></td>
<td></td>
</tr>
</tbody>
</table></div>
<p><strong>[A]</strong> If Alternative architecture mode (ALT_ARCH) is enabled
(default), the IC bypass state will be dynamically changed by the
firmware. Do not use the SET command. The GET command remains
functional.</p>
</div>
<div class="section" id="noise-suppressor-ns">
<h2>Noise Suppressor (NS)<a class="headerlink" href="#noise-suppressor-ns" title="Permalink to this headline">¶</a></h2>
<p>The Noise Suppressor (NS) suppresses noise from sources whose frequency
characteristics do not change rapidly over time. This includes diffuse
background noise and stationary noise sources.</p>
<p>The following table describes the settings for the Noise Suppressor.</p>
<p>Table 4‑17 Noise Suppressor (NS) commands</p>
<div class="table-wrapper"><table class="docutils align-default">
<colgroup>
<col style="width: 35%"/>
<col style="width: 8%"/>
<col style="width: 18%"/>
<col style="width: 39%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>T
ype</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SET_BYPASS_SUP</p>
<p>GET_BYPASS_SUP</p>
</td>
<td><p>uin
t32</p></td>
<td><p>[0,1]</p></td>
<td><p>Set suppressor bypass
parameter. If set to
one, the suppressor,
which contains the noise
suppression stages is
bypassed.</p>
<p>0 - suppressor bypass
disabled (default)</p>
<p>1  - suppressor bypass
enabled</p>
</td>
</tr>
<tr class="row-odd"><td><p>SET_ENABLED_NS</p>
<p>GET_ENABLED_NS</p>
</td>
<td><p>uin
t32</p></td>
<td><p>[0,1]</p></td>
<td><p>Set noise suppression
enabled parameter within
the suppressor. If set
to one, the noise
suppression stage within
suppressor is enabled.
Changing this parameter
only takes effect if the
suppressor is not
bypassed.</p>
<p>0 - noise suppression
disabled</p>
<p>1 - noise suppression
enabled (default)</p>
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="section" id="automatic-gain-control-agc-and-loss-control">
<h2>Automatic Gain Control (AGC) and Loss Control<a class="headerlink" href="#automatic-gain-control-agc-and-loss-control" title="Permalink to this headline">¶</a></h2>
<p>The Automatic Gain Control (AGC) can dynamically adapt the audio gain,
or apply a fixed gain such that voice content maintains a desired output
level. The AGC uses an internal Voice Activity Detector to normalise
voice content and avoid amplifying noise sources and applies a soft
limiter to avoid clipping on the output.</p>
<p>The desired output level of voice content is defined by an upper and
lower threshold. If a voice signal is outside of the upper and lower
threshold then the gain will adapt accordingly. If the voice signal is
within the upper and lower threshold then the gain will remain constant.</p>
<p>The rate at which the gain increases or decreases per audio frame can
also be configured. The gain increment value must be greater than 1,
whilst the gain decrement value must be below 1. When the gain is
adapting, the current gain value is multiplied by either the increment
or decrement value to calculate the gain value to be applied on the next
audio frame.</p>
<p>The Loss Control process improves the subjective audio quality by
attenuating any residual echo of the reference far-end audio. It is
designed to be used on the communications channel. In cases where there
is both far-end echo and near-end audio then the attenuation is reduced,
allowing listeners to interrupt each other. The Loss Control relies on
the Automatic Echo Canceller in order to classify and attenuate residual
far-end echo.</p>
<p>The following table details the configuration parameters for the AGC.</p>
<p>Table 4‑18 Automatic Gain Control (AGC) parameters</p>
<div class="table-wrapper"><table class="docutils align-default">
<colgroup>
<col style="width: 32%"/>
<col style="width: 6%"/>
<col style="width: 17%"/>
<col style="width: 45%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Ty
pe</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SET_ADAPT_CH0_AGC</p>
<p>SET_ADAPT_CH1_AGC</p>
<p>GET_ADAPT_CH0_AGC</p>
<p>GET_ADAPT_CH1_AGC</p>
</td>
<td><p>ui
nt
32</p></td>
<td><p>[0,1]</p></td>
<td><p>Set to enable gain
adaptation in the AGC for
channel 0 or 1.</p>
<p>0 - adaptation disabled for
the channel</p>
<p>1 - adaptation enabled for
the channel</p>
</td>
</tr>
<tr class="row-odd"><td><p>SET
_LC_ENABLED_CH0_AGC</p>
<p>SET
_LC_ENABLED_CH1_AGC</p>
<p>GET
_LC_ENABLED_CH0_AGC</p>
<p>GET
_LC_ENABLED_CH1_AGC</p>
</td>
<td><p>ui
nt
32</p></td>
<td><p>[0,1]</p></td>
<td><p>Set Loss Control to be
enabled in the AGC for
channel 0 or 1.</p>
<p>0 - Loss Control disabled
for the channel</p>
<p>1 - Loss Control enabled for
the channel</p>
</td>
</tr>
<tr class="row-even"><td><p>SET_GAIN_CH0_AGC</p>
<p>SET_GAIN_CH1_AGC</p>
<p>GET_GAIN_CH0_AGC</p>
<p>GET_GAIN_CH1_AGC</p>
</td>
<td><p>Q1
6.
16</p></td>
<td><p>[
0..32767]</p></td>
<td><p>Set the linear gain
parameter to be applied in
the AGC for channel 0 or 1.
Values are linear.</p>
<p>Default: 500</p>
</td>
</tr>
<tr class="row-odd"><td><p>S
ET_MAX_GAIN_CH0_AGC</p>
<p>S
ET_MAX_GAIN_CH1_AGC</p>
<p>G
ET_MAX_GAIN_CH0_AGC</p>
<p>G
ET_MAX_GAIN_CH1_AGC</p>
</td>
<td><p>Q1
6.
16</p></td>
<td><p>[
0..32767]</p></td>
<td><p>Set the maximum gain
threshold in the AGC for
channel 0 or 1. Values are
linear.</p>
<p>Default: 1000</p>
</td>
</tr>
<tr class="row-even"><td><p>SET_UPPE
R_THRESHOLD_CH0_AGC</p>
<p>SET_UPPE
R_THRESHOLD_CH1_AGC</p>
<p>GET_UPPE
R_THRESHOLD_CH0_AGC</p>
<p>GET_UPPE
R_THRESHOLD_CH1_AGC</p>
</td>
<td><p>Q
1.
31</p></td>
<td><p>[0..1]</p></td>
<td><p>Set the upper threshold for
desired voice level. Values
are in range 0 to 1
(full-scale) and must be
greater than the lower
threshold of the channel.</p></td>
</tr>
<tr class="row-odd"><td><p>SET_LOWE
R_THRESHOLD_CH0_AGC</p>
<p>SET_LOWE
R_THRESHOLD_CH1_AGC</p>
<p>GET_LOWE
R_THRESHOLD_CH0_AGC</p>
<p>GET_LOWE
R_THRESHOLD_CH1_AGC</p>
</td>
<td><p>Q
1.
31</p></td>
<td><p>[0..1]</p></td>
<td><p>Set the lower threshold for
desired voice level. Values
are in range 0 to 1
(full-scale) and must be
lower than the upper
threshold of the channel.</p></td>
</tr>
<tr class="row-even"><td><p>SET_INCREMENT_GA
IN_STEPSIZE_CH0_AGC</p>
<p>SET_INCREMENT_GA
IN_STEPSIZE_CH1_AGC</p>
<p>GET_INCREMENT_GA
IN_STEPSIZE_CH0_AGC</p>
<p>GET_INCREMENT_GA
IN_STEPSIZE_CH1_AGC</p>
</td>
<td><p>Q1
6.
16</p></td>
<td><p>[
1..32767]</p></td>
<td><p>Set the rate at which the
gain increases. This value
is applied on a per-frame
basis when voice content is
detected.</p></td>
</tr>
<tr class="row-odd"><td><p>SET_DECCREMENT_GA
IN_STEPSIZE_CH0_AGC</p>
<p>SET_DECREMENT_GA
IN_STEPSIZE_CH1_AGC</p>
<p>GET_DECREMENT_GA
IN_STEPSIZE_CH0_AGC</p>
<p>GET_DECREMENT_GA
IN_STEPSIZE_CH1_AGC</p>
</td>
<td><p>Q1
6.
16</p></td>
<td><p>[0..1]</p></td>
<td><p>Set the rate at which the
gain decreases. This value
is applied on a per-frame
basis when voice content is
detected.</p></td>
</tr>
</tbody>
</table></div>
</div>
<div class="section" id="alternative-architecture-mode-alt-arch">
<h2>Alternative Architecture mode (ALT_ARCH)<a class="headerlink" href="#alternative-architecture-mode-alt-arch" title="Permalink to this headline">¶</a></h2>
<p>The Alternative Architecture mode, when enabled, improves Echo
Cancellation performance in reverberate environments. It operates by
re-configuring the audio pipeline by switching out either the AEC or the
IC, depending on the energy in the AEC reference signal, to recover
resources to be used to increase the specification of the remaining
pipeline.</p>
<p>The two audio pipeline configurations are summarised below:</p>
<ul class="simple">
<li><dl class="simple">
<dt><strong>ALT_ARCH disabled</strong> ALWAYS apply echo-cancelling AND interference</dt><dd><p>cancelling; or</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>ALT_ARCH enabled</strong> apply ONLY echo-cancelling when a reference</dt><dd><p>signal is available, otherwise ONLY apply interference cancelling</p>
</dd>
</dl>
</li>
</ul>
<p>The figure below expands the implementation details of the alternative
mode switching. Multiplexers permit the AEC and/or the IC to be
bypassed. When the IC is bypassed, only a single channel from the AEC is
used, allowing it to be reconfigured, extending the filters to support a
longer tail length. An internal module which collects statistics about
the reference is used to dynamically control these multiplexers and
memory allocation during runtime.</p>
<p>NOTE: Manually bypassing the IC using the Control Interface does not
apply the memory reallocation.</p>
<p>The figure below highlights the audio signal path when the Alternative
Architecture is disabled (ie. standard operation).</p>
<div class="figure align-default" id="id7">
<img alt="../../../_images/image25.png" src="../../../_images/image25.png"/>
<p class="caption"><span class="caption-number">Fig. 16 </span><span class="caption-text">Audio pipeline configuration, [ALT_ARCH=0] mode</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</div>
<p>Whenever ALT_ARCH=1, then the pipeline dynamically switches between AEC
alone, or IC alone. In this condition the AEC is able to make use of
additional memory increasing the echo cancelling period, and making it
more resilient to echo in highly reverberant conditions.</p>
<div class="figure align-default" id="id8">
<img alt="../../../_images/image26.png" src="../../../_images/image26.png"/>
<p class="caption"><span class="caption-number">Fig. 17 </span><span class="caption-text">Audio pipeline configuration, [ALT_ARCH=1] when reference signal is present</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</div>
<p>The dynamic switching uses statistics collected from the reference
signal to establish if echo cancelling is required.</p>
<div class="figure align-default" id="id9">
<img alt="../../../_images/image27.png" src="../../../_images/image27.png"/>
<p class="caption"><span class="caption-number">Fig. 18 </span><span class="caption-text">Audio pipeline configuration, [ALT_ARCH=1] when reference signal is absent</span><a class="headerlink" href="#id9" title="Permalink to this image">¶</a></p>
</div>
<p>The following table summarises the audio characteristics for standard
and alternative architectures.</p>
<p>Table 4‑19 Alternative pipeline mode characteristics</p>
<div class="table-wrapper"><table class="docutils align-default">
<colgroup>
<col style="width: 20%"/>
<col style="width: 36%"/>
<col style="width: 20%"/>
<col style="width: 24%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Pipeline
co
nfiguration</p></th>
<th class="head"><p>Far-end audio (AEC
Ref) status</p></th>
<th class="head"><p>Pipeline
fu
nctionality</p></th>
<th class="head"><p>AEC
C
haracteristics</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ALT_ARCH =
0</p></td>
<td><p>With and without
Far-end audio present</p></td>
<td><p>IC enabled</p>
<p>AEC enabled</p>
</td>
<td><p>Max echo delay
= 150mS</p></td>
</tr>
<tr class="row-odd"><td><p>ALT_ARCH =
1</p></td>
<td><p>No far-end audio</p></td>
<td><p>IC enabled</p>
<p>AEC
disabled</p>
</td>
<td><p>No
cancellation</p></td>
</tr>
<tr class="row-even"><td><p>ALT_ARCH =
1</p></td>
<td><p>Far-end audio present</p></td>
<td><p>IC disabled</p>
<p>AEC enabled</p>
</td>
<td><p>Max echo delay
= 225mS</p></td>
</tr>
</tbody>
</table></div>
<p>The following table describes the configuration parameters for the
Alternative Architecture.</p>
<p>Table 4‑20 Alternative pipeline mode commands</p>
<div class="table-wrapper"><table class="docutils align-default">
<colgroup>
<col style="width: 24%"/>
<col style="width: 6%"/>
<col style="width: 11%"/>
<col style="width: 59%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Ty
pe</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SET_AL
T_ARCH_ENABLED</p>
<p>GET_AL
T_ARCH_ENABLED</p>
</td>
<td><p>ui
nt
32</p></td>
<td><p>[0,1]</p>
<p>0 -
Alt
arch
is
disa
bled.</p>
<p>1 -
Alt
arch
is
en
abled
(def
ault)</p>
</td>
<td><p>Enable or disable alternate
architecture (Alt arch). When alt
arch is enabled, the system works in
either AEC mode (when far end signal
is detected) or IC mode (when far end
signal is not detected). When in AEC
mode in Alt arch, AEC processing
happens on only one Mic channel with
15 phases per mic-ref AEC filter.</p></td>
</tr>
</tbody>
</table></div>
</div>
</div>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="features_interfaces.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">I2C Slave Control interface (XVF3610-INT only)</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="features_booting.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">XVF3610 Features and Configuration</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2019-2021, XMOS Ltd
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="../../../_sources/doc/rst/features/features_audio.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Interfaces, Audio Routing and Filtering</a><ul>
<li><a class="reference internal" href="#signal-flow-and-processing">Signal flow and processing</a><ul>
<li><a class="reference internal" href="#signal-routing-and-scaling">Signal Routing and Scaling</a></li>
<li><a class="reference internal" href="#general-purpose-filter">General Purpose Filter</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#far-field-voice-processing">Far-Field Voice Processing</a><ul>
<li><a class="reference internal" href="#pdm-microphone-interface">PDM microphone interface</a></li>
<li><a class="reference internal" href="#automatic-echo-cancellation-aec">Automatic Echo Cancellation (AEC)</a></li>
<li><a class="reference internal" href="#automatic-delay-estimation-correction-adec">Automatic Delay Estimation &amp; Correction (ADEC)</a></li>
<li><a class="reference internal" href="#interference-canceller">Interference canceller</a></li>
<li><a class="reference internal" href="#noise-suppressor-ns">Noise Suppressor (NS)</a></li>
<li><a class="reference internal" href="#automatic-gain-control-agc-and-loss-control">Automatic Gain Control (AGC) and Loss Control</a></li>
<li><a class="reference internal" href="#alternative-architecture-mode-alt-arch">Alternative Architecture mode (ALT_ARCH)</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/tabs.js"></script>
    <script src="../../../_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>