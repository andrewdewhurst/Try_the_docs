<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" /><link rel="next" title="Interfaces, Audio Routing and Filtering" href="features_audio.html" /><link rel="prev" title="Product features" href="index.html" />

    <meta name="generator" content="sphinx-3.5.4, furo 2021.04.11.beta34"/>
        <title>XVF3610 Features and Configuration - XVF3610 2.0.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/styles/furo.css?digest=59ab60ac09ea94ccfe6deddff6d715cce948a6fc">
    <link rel="stylesheet" href="../../../_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../../../_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" href="../../../_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">XVF3610 2.0.0 documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../../_static/xmos_logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">XVF3610 2.0.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../before_you_start.html">Before you start</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../LICENSE.html">XMOS PUBLIC LICENCE: Version 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../COPYRIGHTS.html">Copyright</a></li>
<li class="toctree-l2"><a class="reference internal" href="../version_info.html">Tool and Architecture Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../CHANGELOG.html">lib_xud Change Log</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../overview/index.html">XVF3610 Product description</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../overview/introduction.html">XVF3610 Far-field voice processor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/architecture.html">XVF3610 System Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/audio_pipeline.html">XVF3610 Voice Processing Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/control_interface.html">Principles of configuration, control and usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/firmware_package.html">Firmware release package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/firmware_package.html#required-tools">Required Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/firmware_package.html#command-line-interface-vfctrl">Command-line interface (vfctrl)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/firmware_package.html#configuration-via-control-interface">Configuration via Control interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/development_kits.html">Development kits</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Product features</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">XVF3610 Features and Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="features_audio.html">Interfaces, Audio Routing and Filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="features_audio.html#far-field-voice-processing">Far-Field Voice Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="features_interfaces.html">I2C Slave Control interface (XVF3610-INT only)</a></li>
<li class="toctree-l2"><a class="reference internal" href="features_interfaces.html#general-purpose-input-and-output-and-peripheral-bridging">General Purpose Input and Output and Peripheral Bridging</a></li>
<li class="toctree-l2"><a class="reference internal" href="features_interfaces.html#gpio">GPIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="features_interfaces.html#i2c-master-peripheral-interface-xvf3610-ua-only">I2C Master peripheral interface (XVF3610-UA Only)</a></li>
<li class="toctree-l2"><a class="reference internal" href="features_interfaces.html#spi-master">SPI Master</a></li>
<li class="toctree-l2"><a class="reference internal" href="features_usb.html">USB Interface</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference/index.html">Reference information</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/XVF3610_parameter_summary.html">Parameter summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/Boot_Status_codes.html">Boot status codes (RUN_STATUS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/Example_SPISPEC.html">Example .SPISPEC file format</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/SPI_Booting_of_XVF3610-UA_dev_kit.html">SPI Boot custom connection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/USB_Enumeration_data.html">USB enumeration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/USB-HID_example.html">USB HID - Example using the development kit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/General_purpose_filter_example.html">General purpose filter example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/Control_parameter_protocol.html">Command transport protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/Flash_programming_flow.html">Flash programming and update flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/Capturing_packed_samples.html">Capturing packed samples for system integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/Command_table.html">Command list</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../other_resources/index.html">Additional Information</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../other_resources/documentation.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other_resources/firmware.html">Device firmware and software</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../other_resources/index.html#revision-history">Revision History</a></li>
</ul>

</div>

    <select name="version" id="version-select" value="Latest" onchange="changeVersion(this.value)" >
    <option selected disabled>Other versions</option>
    <option value="html/v1/">v1</option>
    <option value="html/v2.0.0/">v2.0.0</option>
    <option value="html/latest/">latest</option>
    </select>

    <script>
    function changeVersion(val) {
        var loc = window.location.toString();
        var i = loc.indexOf("html/");
        if (i >= 0) {
            var s1 = loc.substring(0, i);
            var i2 = loc.indexOf("/", i+6)
            var s2 = loc.substring(i2+1);
            nl=s1.concat(val, s2);


            var request = new XMLHttpRequest();  
            request.open('GET', nl, true);
            request.onreadystatechange = function(){
            if (request.readyState === 4){
                if (request.status === 404) {  
                    alert("Oh no, it does not exist!");
                    window.location.assign(loc);
                    location.reload();
                }
                else {
                    window.location.assign(nl);
                }  
            }
        };
        request.send();    
        }
    }
    </script>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="xvf3610-features-and-configuration">
<h1>XVF3610 Features and Configuration<a class="headerlink" href="#xvf3610-features-and-configuration" title="Permalink to this headline">¶</a></h1>
<p>This section describes in detail the features and configuration of the
XVF3610 voice processor. It is organised into four sections which cover
the main aspects of usage and configuration:</p>
<ul class="simple">
<li><p>Booting;</p></li>
<li><p>Configuration and the Data Partition;</p></li>
<li><p>Interfaces, Audio Routing and filtering;</p></li>
<li><p>Far-field voice processing.</p></li>
</ul>
<div class="section" id="booting">
<h2>Booting<a class="headerlink" href="#booting" title="Permalink to this headline">¶</a></h2>
<p>As demonstrated with the VocalFusion development kits the standard
mechanism for booting is from an attached QSPI Flash device. This
provides standalone operation, and persistent storage for configuration
data. VocalFusion XVF3610 supports device firmware upgrade (DFU) over
USB (-UA product variant) and I<sup>2</sup>C (-INT product variant).
Pre-compiled host utilities, and source code for reference, are supplied
for performing DFU operations. The pre-compiled utilities can be found
in the release package in one of the host architecture directories eg.
hostWin32bindfu_usb.exe, and the source code in hostsrcdfu.</p>
<p>NOTE: While the functionality of the DFU is similar to the USB DFU
specification, it has diverged to accommodate both USB and I2C operation
and therefore is not compatible with compliant USB DFU tools.</p>
<p>The following sections discuss the structure of data within the flash
memory, and operation of DFU.</p>
<div class="section" id="flash-storage-structure">
<h3>Flash storage structure<a class="headerlink" href="#flash-storage-structure" title="Permalink to this headline">¶</a></h3>
<p>The structure of data within the VocalFusion XVF3610 is arranged to
contain a factory image, a single upgrade image, device serial numbers
and data partitions for both the factory and upgrade image. This is
shown below.</p>
<div class="figure align-default" id="id1">
<img alt="../../../_images/image11.png" src="../../../_images/image11.png"/>
<p class="caption"><span class="caption-number">Fig. 9 </span><span class="caption-text">Flash data structure for VocalFusion XVF3610</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<ul class="simple">
<li><p>The <strong>factory boot image</strong> is the executable code for VocalFusion and
is supplied in the Release Package in the bin directory. The file
format is xe, which refers to XMOS Executable. This is written to
the device via the XTAG debugger or through a bulk flash
programming operation.</p></li>
<li><p>The <strong>upgrade boot image</strong>, if present, is the executable code
written to the flash memory via a DFU operation. Generation of the
upgrade boot image is covered below.</p></li>
<li><p>The <strong>HW build info</strong> is specified in the .json Data Partition file
for the factory image and is written at the same time as the
factory image and Data Partition. It is a unique identifier which
is unaffected by subsequent DFU upgrade operations.</p></li>
<li><p>The <strong>Serial Number</strong> is a custom field which can be programmed via
USB and I2S control interfaces and remains untouched by the
subsequent DFU operations.</p></li>
<li><p>The <strong>Factory and Upgrade Data Partitions</strong> are the associated Data
Partitions for the Factory and Upgrade images (where upgrade is
present). They are written to flash in the same operation as the
boot images. For more information on the generation and usage of
Data Partitions see <em>Configuration and the Data Partition</em>
section.</p></li>
</ul>
<p>NOTE: Storage of only a single upgrade boot image and Data Partition
pair are supported. Therefore, any Upgrade image applied will overwrite
any existing upgrade image present.</p>
<p>A summary of the factory programming and field update process for
flash-based systems is shown in the <em>Appendix I: Flash programming and
update flow.</em></p>
</div>
<div class="section" id="programming-the-factory-boot-image-and-data-partition">
<h3>Programming the Factory Boot image and Data Partition<a class="headerlink" href="#programming-the-factory-boot-image-and-data-partition" title="Permalink to this headline">¶</a></h3>
<p>The process to program the Factory Boot image and Data Partition is
described in the <em>Updating the firmware</em> section.</p>
</div>
<div class="section" id="upgrade-images-and-data-partitions">
<h3>Upgrade Images and Data Partitions<a class="headerlink" href="#upgrade-images-and-data-partitions" title="Permalink to this headline">¶</a></h3>
<p>In order to be able to apply an Upgrade image to the device it must be
programmed with a Factory Image and Data Partition as described above.</p>
<p>The DFU process requires the use of two utilities, dfu_usb or dfu_i2c,
depending on the firmware variant, and dfu_suffix_generator. Precompiled
versions are provided as part of the Release Package in the appropriate
platform directory in \host (eg. \hostWin32bin), and the source code
for the DFU utility is provided in the \hostsrcdfu directory. For
more information on building the host applications refer to the build
instruction file in \hosthow_to_build_host_apps.rst in the Release
Package.</p>
<p>In addition to the DFU utilities, the Upgrade image and Data Partition
are required. These are provided in the Release Package in the \bin and
\data-partitionimages. Generation of custom Data Partitions is
detailed in the <em>Configuration and the Data Partition</em> section. There
are a number of stages required to prepare and execute a DFU to ensure
are safe and successful update. These are detailed below.</p>
<div class="section" id="generation-of-binary-upgrade-image">
<h4>Generation of Binary Upgrade image<a class="headerlink" href="#generation-of-binary-upgrade-image" title="Permalink to this headline">¶</a></h4>
<p>First, the Upgrade Image (.xe) needs to be converted to a binary format.
Use xflash and the following command to convert the .xe image into a
binary form  (note multiple lines have been used for clarity in command
examples, but should be executed on single line):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>xflash --no-compression --noinq --factory-version <span class="m">14</span>.3 --upgrade <span class="o">[</span>UPGRADE_VERSION<span class="o">]</span> <span class="o">[</span>UPGRADE_EXECUTABLE<span class="o">]</span> -o <span class="o">[</span>OUTPUT_BINARY_NAME<span class="o">]</span>
</pre></div>
</div>
<p>Even though the latest and recommended version of the tools is version
14.4.x, for legacy reasons we specify –factory-version value of 14.3.
(The 14.3 value refers to boot loader API while 14.4 is toolchain
version that retained the 14.3 API.)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Should a different version of the tools be used, for example a
future release, the version number should be noted such that an update
image of compatible format can be created.</p>
</div>
<p>The upgrade version number is specified with –upgrade. The format is as
follows 16bit 0xJJMP where J is major, M is minor and P is point.</p>
<p>For example, to create an upgrade Binary image for a -UA system, from
the v4.0.0 Release Package use the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>xflash --no-compression --noinq --factory-version <span class="m">14</span>.3 --upgrade 0x0400 app_xvf3610_ua_v4.0.0.xe -o app_xvf3610_ua_v4.0.0.bin
</pre></div>
</div>
</div>
<div class="section" id="addition-of-dfu-suffix-to-binary-files">
<h4>Addition of DFU Suffix to Binary files<a class="headerlink" href="#addition-of-dfu-suffix-to-binary-files" title="Permalink to this headline">¶</a></h4>
<p>To prevent accidental upgrade of an incompatible image both the binary
Upgrade image and the Data Partition binary must be signed using the
provided dfu_suffix_generator which can be found pre-compiled in the
host platform directory of the release package eg. \hostMACbin.</p>
<p>This mechanism embeds a structure into the binary files which can be
read by the DFU tool to check that the binary data is appropriate for
the connected device, prior to executing.</p>
<p>The general form of usage for the dfu_suffix_generator is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dfu_suffix_generator</span> <span class="n">VENDOR_ID</span> <span class="n">PRODUCT_ID</span> <span class="p">[</span><span class="n">BCD_DEVICE</span><span class="p">]</span> <span class="n">BINARY_INPUT_FILE</span> <span class="n">BINARY_OUTPUT_FILE</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">VENDOR_ID</span></code>, <code class="docutils literal notranslate"><span class="pre">PRODUCT_ID</span></code> and <code class="docutils literal notranslate"><span class="pre">BCD_DEVICE</span></code> are non-zero 16bit values decimal
or hexadecimal format, <code class="docutils literal notranslate"><span class="pre">0xFFFF</span></code> bypassing verification of this field.</p>
<p>When building Upgrade images for XVF3610-UA devices, the USB Vendor
Identifier (VID) and USB Product Identifier (PID) are added to the
header and then checked by the DFU utility that the connected device
matches. An error is reported by the tool if there is no match with the
connected device.</p>
<p>For XVF3610-INT devices both Vendor and Product ID fields should be set
to 0xFFFF for the generation. This instructs the DFU to bypass the
checking as there is no equivalent to the USB identifiers for I2C
systems. However, even though the checking is bypassed for the
XVF3610-INT the suffix must be added to both Upgrade and Data partition
files as the DFU utility checks the integrity of the binaries based on
this information.</p>
<p>The following examples show how to add DFU Suffix to Update binaries for
both XVF3610-INT and XVF3610-UA products.</p>
<p>For XVF3610-UA (default XMOS Vendor and XVF3610-UA product identifiers
are used for illustration):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dfu_suffix_generator</span><span class="o">.</span><span class="n">exe</span> <span class="mh">0x20B1</span> <span class="mh">0x0014</span> <span class="n">app_xvf3610_ua_v4</span><span class="mf">.0.0</span><span class="o">.</span><span class="n">bin</span> <span class="n">boot</span><span class="o">.</span><span class="n">dfu</span>

<span class="n">dfu_suffix_generator</span><span class="o">.</span><span class="n">exe</span> <span class="mh">0x20B1</span> <span class="mh">0x0014</span> <span class="n">data_partition_upgrade_ua_v4_0_0</span><span class="o">.</span><span class="n">bin</span> <span class="n">data</span><span class="o">.</span><span class="n">dfu</span>
</pre></div>
</div>
<p>For XVF3610-INT:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dfu_suffix_generator</span><span class="o">.</span><span class="n">exe</span> <span class="mh">0xFFFF</span> <span class="mh">0xFFFF</span> <span class="n">app_xvf3610_int_v4</span><span class="mf">.0.0</span><span class="o">.</span><span class="n">bin</span> <span class="n">boot</span><span class="o">.</span><span class="n">dfu</span>

<span class="n">dfu_suffix_generator</span><span class="o">.</span><span class="n">exe</span> <span class="mh">0xFFFF</span> <span class="mh">0xFFFF</span> <span class="n">data_partition_upgrade_int_v4_0_0</span><span class="o">.</span><span class="n">bin</span> <span class="n">data</span><span class="o">.</span><span class="n">dfu</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Extreme care must be taken if modifying the default Vendor and
Product IDs through a Data Partition. If configuration from Data
Partition fails the USB VID and PID will remain at their default values
(VID=0x20B1, PID=0x0014) and DFU requests for signed files with modified
will not be allowed.</p>
</div>
</div>
<div class="section" id="performing-dfu">
<h4>Performing DFU<a class="headerlink" href="#performing-dfu" title="Permalink to this headline">¶</a></h4>
<p>The pre-compiled DFU utility is provided in the Release Package in the
host architecture directory eg. \hostLinuxbin. For MAC, Linux and
Windows the DFU_USB is provided, and for PI DFU_I2C is provided. The
source code can be used to rebuild either version on the required
platform.</p>
<p>The general form of dfu_usb utility is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dfu_usb</span> <span class="p">[</span><span class="n">OPTIONS</span><span class="p">]</span> <span class="n">write_upgrade</span> <span class="n">BOOT_IMAGE_BINARY</span> <span class="n">DATA_PARTITION_BIN</span>
</pre></div>
</div>
<p>OPTIONS: –quiet</p>
<p>–vendor-id 0x20B1 (default)</p>
<p>–product-id 0x0014 (default)</p>
<p>–bcd-device 0xFFFF (default)</p>
<p>–block-size 128 (default)</p>
<p>and the general form of the dfu_i2c utility is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dfu_i2c</span> <span class="p">[</span><span class="n">OPTIONS</span><span class="p">]</span> <span class="n">write_upgrade</span> <span class="n">BOOT_IMAGE_BINARY</span> <span class="n">DATA_PARTITION_BIN</span>
</pre></div>
</div>
<p>OPTIONS: –quiet</p>
<p>–i2c-address 0x2c (default)</p>
<p>–block-size 128 (default)</p>
<p>The two binary files passed to the utility, the boot image and data
partition, must have the DFU suffix present otherwise the DFU utility
will generate an error. Example DFU utility usage is shown for both
XVF3610-UA and XVF3610-INT below.</p>
<p>For XVF3610-UA:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dfu_usb</span> <span class="o">--</span><span class="n">vendor</span><span class="o">-</span><span class="nb">id</span> <span class="mh">0x20B1</span> <span class="o">--</span><span class="n">product</span><span class="o">-</span><span class="nb">id</span> <span class="mh">0x0014</span> <span class="n">write_upgrade</span> <span class="n">boot</span><span class="o">.</span><span class="n">dfu</span> <span class="n">data</span><span class="o">.</span><span class="n">dfu</span>
</pre></div>
</div>
<p>and for XVF3610-INT:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dfu_i2c</span> <span class="n">write_upgrade</span> <span class="n">boot</span><span class="o">.</span><span class="n">dfu</span> <span class="n">data</span><span class="o">.</span><span class="n">dfu</span>
</pre></div>
</div>
<p>Once complete the following message will be returned and the device will
reboot. In the case of XVF3610-UA the device will re-enumerate.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">write</span> <span class="n">upgrade</span> <span class="n">successful</span>
</pre></div>
</div>
<p>For verification that DFU has succeeded as planned, the <code class="docutils literal notranslate"><span class="pre">vfctrl</span></code> utility
can be used to query the firmware version before and after update. For
example, to query the version of XVF3610-UA the following command is
used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vfctrl_usb</span> <span class="n">GET_VERSION</span>
</pre></div>
</div>
<p>NOTE: The <code class="docutils literal notranslate"><span class="pre">vfctrl</span></code> utilities check the version number of the connected
device to ensure correct operation. To suppress an error caused by a
disparity in the version of <code class="docutils literal notranslate"><span class="pre">vfctrl</span></code> and upgraded firmware the
<code class="docutils literal notranslate"><span class="pre">--no-check-version</span></code> option can be used with the utility.</p>
</div>
</div>
<div class="section" id="factory-restore">
<h3>Factory restore<a class="headerlink" href="#factory-restore" title="Permalink to this headline">¶</a></h3>
<p>To restore the device to its factory configuration, effectively
discarding any upgrades made, the same process as outlined above is
followed but using a blank Boot Image and Data Partition.</p>
<p>This is the only way a restore can be initiated as the device does not
have the ability to restore itself.</p>
<p>The same blank file can be used for both Boot Image and Data partition
and can be generated using <code class="docutils literal notranslate"><span class="pre">dd</span></code> on MAC and Linux, and <code class="docutils literal notranslate"><span class="pre">fsutil</span></code> in windows as
shown below:</p>
<p>An blank image can be created with a file of zeroes the size of one
flash sector. In the normal case of 4KB sectors on a UNIX-compatible
platform, this can be created as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dd</span> <span class="n">bs</span><span class="o">=</span><span class="mi">4096</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">zero</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="n">blank</span><span class="o">.</span><span class="n">dfu</span>
</pre></div>
</div>
<p>and for Windows systems:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fsutil</span> <span class="n">file</span> <span class="n">createNew</span> <span class="n">blank</span><span class="o">.</span><span class="n">dfu</span> <span class="mi">4096</span>
</pre></div>
</div>
<p>The process outlined in the <em>Generation and application of Upgrade Image
and Data Partition</em> section can now be followed using the blank.dfu file
for both Boot Image and Data Partition.</p>
</div>
<div class="section" id="boot-image-and-data-partition-compatibility-checks">
<h3>Boot Image and Data Partition Compatibility checks<a class="headerlink" href="#boot-image-and-data-partition-compatibility-checks" title="Permalink to this headline">¶</a></h3>
<p>The format of Data Partitions and Boot Images may change between version
increments. Therefore to prevent incompatible Boot and Data Partitions
from running and causing undefined behaviour, a field called
compatibility version is embedded into the Data Partition. A running
Boot Image checks its own version, against the compatibility version in
the Data Partition before reading the partition data.</p>
<p>The version of the firmware should also be specified in the <code class="docutils literal notranslate"><span class="pre">--upgrade</span></code>
argument of <code class="docutils literal notranslate"><span class="pre">xflash</span></code> when generating the Upgrade Image as described
previously.</p>
<p>If the compatibility check fails, the booted image, which could be a
factory image or an upgrade image will not read the Data Partition and
will operate with its default settings (described in Default Operation
section above). The Boot status is reported in the RUN_STATUS register
which can be accessed via the <code class="docutils literal notranslate"><span class="pre">vfctrl</span></code> utility, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vfctrl_usb</span><span class="o">.</span><span class="n">exe</span> <span class="n">GET_RUN_STATUS</span>
</pre></div>
</div>
<p>Successful Boot status is reported by either FACTORY_DATA_SUCCESS or
UPGRADE_DATA_SUCCESS depending on which Boot Image was executed.</p>
<p>If unsuccessful the device will revert to a fail-safe mode of operation.
The RUN_STATUS register can be queried for further debug information.
The full list of RUN_STATUS codes are described in the <em>Appendix B: Boot
Status codes (RUN_STATUS).</em></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Fail safe mode uses default vendor ID of 0x20B1 (XMOS) and product
ID of 0x14. In this event, host needs to be equipped with the ability to
locate USB device under different IDs.</p>
</div>
</div>
<div class="section" id="custom-flash-memory-devices">
<h3>Custom flash memory devices<a class="headerlink" href="#custom-flash-memory-devices" title="Permalink to this headline">¶</a></h3>
<p>The majority of QSPI flash devices conform to the same set of parameters
which define the access and usage of flash devices. However, to support
instances when the flash interface parameters are different, the
following section explains how to define a custom flash interface.</p>
<p>Details of the flash device used to store the Boot Image and Data
Partition data must be specified in two locations to ensure successful
Factory programming and the ability to execute DFU to Upgrade the
firmware. The Development kit uses a standard QSPI flash device which is
representative of most 2MByte QSPI devices.</p>
<div class="section" id="custom-flash-definition-for-factory-programming">
<h4>Custom flash definition for factory programming<a class="headerlink" href="#custom-flash-definition-for-factory-programming" title="Permalink to this headline">¶</a></h4>
<p>During the Factory programming procedure, using the XMOS XTAG debugger,
the specification of the flash device is used to create the loader which
is responsible for downloading the Boot Image from flash and to the
device. The flash specification is provided to XFLASH, as described in
the <em>Updating the Firmware</em> section, using a SPISPEC file. A
representative SPISPEC file, which supports the majority of QSPI flash
devices and the Development Kits is provided in the Release Package
here:</p>
<p>\data-partition16mbit_12.5mhz_sector_4kb.spispec</p>
<p>This is a text file and must be modified with any differing parameters.
An example .spispec file is shown in <em>Appendix C: Example .SPISPEC File
Format</em> section.</p>
</div>
<div class="section" id="custom-flash-definition-for-data-partition-generation">
<h4>Custom flash definition for Data Partition generation<a class="headerlink" href="#custom-flash-definition-for-data-partition-generation" title="Permalink to this headline">¶</a></h4>
<p>The SPISPEC file must also be included in the Data Partition, along with
the Sector size so that DFU operations can be executed correctly.</p>
<p>NOTE: Due to the nature of the DFU function, it is critically important
to test the execution of the DFU process in a target system prior to
production manufacturing.</p>
</div>
</div>
<div class="section" id="spi-slave-boot">
<h3>SPI Slave Boot<a class="headerlink" href="#spi-slave-boot" title="Permalink to this headline">¶</a></h3>
<p>This process was changed from V4.1 of the firmware</p>
<p>Both -UA and -INT configurations of XVF3610 have an SPI slave boot mode,
in addition to the boot from flash mode. The SPI slave boot downloads
the boot image in binary form, provided in the Release Package. This is
illustrated using a Raspberry Pi and the Python script to manage the
transfer as discussed below.</p>
<div class="section" id="spi-boot-of-xvf3610-int-using-development-kit-and-raspberry-pi">
<h4>SPI Boot of XVF3610-INT using Development Kit and Raspberry Pi<a class="headerlink" href="#spi-boot-of-xvf3610-int-using-development-kit-and-raspberry-pi" title="Permalink to this headline">¶</a></h4>
<p>Using the Development Kit, assembled as described in section
<em>XVF3610-INT Amazon AVS demonstration</em>, and the XVF3610-INT Release
Package available on the Raspberry Pi, a SPI boot can be executed by
following the steps below:</p>
<ol class="arabic">
<li><p>Using a terminal console on the Raspberry Pi, navigate to the
location of the XVF3610-INT Release Package.</p></li>
<li><p>Use the following command to execute the SPI boot process booting
the XVF3610-INT firmware in the Release Package (replacing vX_X_X with the appropriate version number):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3 host/Pi/scripts/send_image_from_rpi.py bin/app_xvf3610_int_spi_boot_vX_X_X.bin --delay
</pre></div>
</div>
</li>
</ol>
<p>The device should be ready within 3 seconds.</p>
<ol class="arabic">
<li><p>Update the main clock in to PDM clock specific using the
VocalFusion Control Utility <code class="docutils literal notranslate"><span class="pre">vfctrl_i2c</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./host/Pi/bin/vfctrl_i2c SET_MCLK_IN_TO_PDM_CLK_DIVIDER <span class="m">1</span>
</pre></div>
</div>
</li>
<li><p>Configure any system specific settings using the VocalFusion
Control Utility <code class="docutils literal notranslate"><span class="pre">vfctrl_i2c</span></code>.</p></li>
<li><p>Start the XVF3610 processing and interfaces by issuing the
following commands over the VocalFusion control utility:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./host/Pi/bin/vfctrl_i2c SET_MIC_START_STATUS <span class="m">1</span>

./host/Pi/bin/vfctrl_i2c SET_I2S_START_STATUS <span class="m">1</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Following an SPI boot the XVF3610 will not read any Data Partition
that may be present in flash memory. This is the reason why step 3 is
necessary, the command SET_MCLK_IN_TO_PDM_CLK_DIVIDER is included in the
Data Partition for XVF3610-INT.</p>
</div>
</div>
<div class="section" id="spi-boot-of-xvf3610-ua-using-development-kit-and-raspberry-pi">
<h4>SPI Boot of XVF3610-UA using Development Kit and Raspberry Pi<a class="headerlink" href="#spi-boot-of-xvf3610-ua-using-development-kit-and-raspberry-pi" title="Permalink to this headline">¶</a></h4>
<p>NOTE: To illustrate the SPI Boot of XVF3610-UA on the development kit
custom connection must be made between Pi Hat and XVF3610 Processor
board. The connection is discussed in more detail in <em>Appendix D: SPI
Boot custom connection.</em></p>
<p>Using the XVF3610-UA Release Package available on the Raspberry Pi, a
SPI boot can be executed by following the steps below:</p>
<ol class="arabic">
<li><p>Using a terminal console on the Raspberry Pi, navigate to the
location of the XVF3610-UA Release Package.</p></li>
<li><p>Use the following command to execute the SPI boot process booting
the XVF3610-UA firmware in the Release Package (replacing vX_X_X with
the appropriate version number):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3 host/Pi/scripts/send_image_from_rpi.py bin/app_xvf3610_ua_spi_boot_vX_X_X.bin --delay
</pre></div>
</div>
</li>
</ol>
<p>The device should be boot within 3 seconds.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The delay start mode is not available for XVF3610-UA.</p>
</div>
</div>
</div>
</div>
<div class="section" id="configuration-and-the-data-partition">
<h2>Configuration and the Data Partition<a class="headerlink" href="#configuration-and-the-data-partition" title="Permalink to this headline">¶</a></h2>
<p>As described in a previous section, when using flash to boot the XVF3610
processor, the Data partition can be used to store commands which are
executed immediately after boot-up to configure and define the
functionality of the device. The following sections describe the
definition of the Data Partition, how to generate, and the customisation
for specific applications.</p>
<div class="section" id="data-partition-definition">
<h3>Data Partition definition<a class="headerlink" href="#data-partition-definition" title="Permalink to this headline">¶</a></h3>
<div class="section" id="partition-file-structure">
<h4>Partition file structure<a class="headerlink" href="#partition-file-structure" title="Permalink to this headline">¶</a></h4>
<p>The contents of a Data Partition are defined in a .json file which is
passed to a generation script which forms the binary files used when
flashing the device. The generation process is described below, after
the definition .json file is described.</p>
<p>For the purpose of explanation consider the following example for a
custom XVF3610-UA Data Partition:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="nt">"comment"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
<span class="nt">"spispec_path"</span><span class="p">:</span> <span class="s2">"16mbit_12.5mhz_sector_4kb.spispec"</span><span class="p">,</span>
<span class="nt">"regular_sector_size"</span><span class="p">:</span> <span class="s2">"4096"</span><span class="p">,</span>
<span class="nt">"hardware_build"</span><span class="p">:</span> <span class="s2">"0xFFFFFFFF"</span><span class="p">,</span>
<span class="nt">"item_files"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="nt">"path"</span><span class="p">:</span> <span class="s2">"input/usb_to_device_rate_48k.txt"</span><span class="p">,</span> <span class="nt">"comment"</span><span class="p">:</span> <span class="s2">""</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nt">"path"</span><span class="p">:</span> <span class="s2">"input/device_to_usb_rate_48k.txt"</span><span class="p">,</span> <span class="nt">"comment"</span><span class="p">:</span> <span class="s2">""</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nt">"path"</span><span class="p">:</span> <span class="s2">"input/usb_mclk_divider.txt"</span><span class="p">,</span> <span class="nt">"comment"</span><span class="p">:</span> <span class="s2">""</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nt">"path"</span><span class="p">:</span> <span class="s2">"input/xmos_usb_params.txt"</span><span class="p">,</span> <span class="nt">"comment"</span><span class="p">:</span> <span class="s2">""</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nt">"path"</span><span class="p">:</span> <span class="s2">"input/i2s_rate_16k.txt"</span><span class="p">,</span> <span class="nt">"comment"</span><span class="p">:</span> <span class="s2">""</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nt">"path"</span><span class="p">:</span> <span class="s2">"input/led_after_boot.txt"</span><span class="p">,</span> <span class="nt">"comment"</span><span class="p">:</span><span class="s2">""</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Comment pairs are provided for the .json configuration, but also the
individual item files:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="nt">"comment"</span><span class="p">:</span> <span class="s2">""</span> <span class="p">}</span>
</pre></div>
</div>
<p>A running VocalFusion device needs to know size and geometry of its
external QSPI flash in order to write firmware upgrades to it. This is
added to a Data Partition in the form of a flash specification or SPI
specification (See Appendix C for custom flash support)</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="nt">"spispec_path"</span><span class="p">:</span> <span class="s2">"16mbit_12.5mhz_sector_4kb.spispec"</span> <span class="p">}</span>
</pre></div>
</div>
<p>The Data Partition generation process aligns various sections onto flash
sectors, and needs to know the sector size (this can be found in the
flash device datasheet):</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="nt">"regular_sector_size"</span><span class="p">:</span> <span class="s2">"4096"</span> <span class="p">}</span>
</pre></div>
</div>
<p>Hardware build is a custom-defined, 32bit identifier written to flash
along with the application firmware. It can be used to define a unique
identifier for the hardware revision or other information which cannot
be overwritten by subsequent updates:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="nt">"hardware_build"</span><span class="p">:</span> <span class="s2">"0xFFFFFFFF"</span> <span class="p">}</span>
</pre></div>
</div>
<p>Item files which contain the commands to execute (format of item files
described below). An optional comment field is provided:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="nt">"path"</span><span class="p">:</span> <span class="s2">"input/usb_to_device_rate_48k.txt"</span><span class="p">,</span> <span class="nt">"comment"</span><span class="p">:</span> <span class="s2">""</span> <span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because the generator is a Python script, the paths uses forward
slashes irrespective of platform.</p>
</div>
</div>
<div class="section" id="item-files">
<h4>Item files<a class="headerlink" href="#item-files" title="Permalink to this headline">¶</a></h4>
<p>The item files contain the commands used to configure the system. The
commands are simply added to the file in the same format as the command
line control utility. For clarity, multiple item files can be included
in the .json definition, each specifying a sub-set of commands relating
to a particular function or aspect. Example item files for common
configurations are provided in the data-partition/input directory of the
release package. For example, the agc_bypass.txt item file bypasses the
AGC for both output channels contains the following commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>SET_ADAPT_CH0_AGC <span class="m">0</span>
SET_ADAPT_CH1_AGC <span class="m">0</span>
SET_GAIN_CH0_AGC <span class="m">1</span>
SET_GAIN_CH1_AGC <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="generating-a-data-partition-for-custom-applications">
<h3>Generating a Data Partition for custom applications<a class="headerlink" href="#generating-a-data-partition-for-custom-applications" title="Permalink to this headline">¶</a></h3>
<p>It is recommended that in order to create a custom Data Partition, an
existing set of .json and item files is used as a template and modified
as required. The release package contains example .json and item files
for this purpose.</p>
<p>NOTE: The following process requires the use of Python 3. Installation
is covered in <em>Required Tools</em> section.</p>
<p>The required additional control commands should be stored in an
appropriately named text file inside the <code class="docutils literal notranslate"><span class="pre">data-partition/input</span></code>
subdirectory. For example, a file named <code class="docutils literal notranslate"><span class="pre">aec_bypass.txt</span></code> could be added
containing the collected commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>SET_BYPASS_AEC <span class="m">1</span>
</pre></div>
</div>
<p>NOTE: Only commands which are required to be set with non-default values
need to be included in the item file list.</p>
<p>These text files are then included in the custom JSON description.</p>
<p>In the above example, the <code class="docutils literal notranslate"><span class="pre">aec_bypass.txt</span></code> is added to to a JSON
description, <code class="docutils literal notranslate"><span class="pre">bypass_AEC.json</span></code> as shown below:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="nt">"item_files"</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
    <span class="nt">"path"</span><span class="p">:</span> <span class="s2">"input/aec_bypass.txt"</span><span class="p">,</span>
    <span class="nt">"comment"</span><span class="p">:</span> <span class="s2">"bypass AEC processing"</span>
      <span class="p">}</span>
    <span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The execution order of the commands and input files can affect
the behaviour of the device. Commands to configure USB and I2S
should be added at the beginning of the data image.**</p>
</div>
<p>Finally, to generate the custom data partition, the command below should
be run from the data-partition directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3 xvf3610_data_partition_generator.py &lt;build_type&gt;.json
</pre></div>
</div>
<p>The generator script produces two data image files; one for factory
programming and one for device upgrade in a directory named output.</p>
<p>For the above example these files will be called:</p>
<p><code class="docutils literal notranslate"><span class="pre">data_partition_factory_&lt;build_type&gt;.bin</span></code></p>
<p>and</p>
<p><code class="docutils literal notranslate"><span class="pre">data_partition_upgrade_&lt;build_type&gt;.bin</span></code>.</p>
<p>These two binary files can be used to factory program or upgrade as
described in <em>Updating the firmware</em> and <em>Generation and application of
Upgrade Image and Data Partition</em> sections respectively.</p>
<p>A .JSON file is also produced for debugging purposes.</p>
</div>
<div class="section" id="serial-number">
<h3>Serial Number<a class="headerlink" href="#serial-number" title="Permalink to this headline">¶</a></h3>
<p>The XVF3610 allows a 24 ASCII character long serial number to be stored
in the external flash memory. This can be accessed using the VocalFusion
Control application using the following commands (XVF3610-INT shown for
example). To write to the serial number register use:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vfctrl_i2c SET_SERIAL_NUMBER <span class="s2">"DEADBEEF"</span>
</pre></div>
</div>
<p>and to read use:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vfctrl_i2c GET_SERIAL_NUMBER
</pre></div>
</div>
<div class="section" id="usb-device-enumeration-xvf3610-ua-only">
<h4>USB device enumeration (XVF3610-UA only)<a class="headerlink" href="#usb-device-enumeration-xvf3610-ua-only" title="Permalink to this headline">¶</a></h4>
<p>The XVF3610-UA additionally allows the Serial Number to be copied into
the iSerialNumber field of the USB descriptor. As the host reads the USB
descriptor on enumeration the command to copy the serial number must be
present in the Data Partition. To illustrate this process the following
commands must be incorporated into a Data Partition in the specified
order (example assumes SERIAL_NUMBER field is already populated).</p>
<p>To set the USB configuration to use the serial number in the descriptor
add the following lines, in this order, to the Data Partition:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SET_USB_SERIAL_NUMBER</span> <span class="mi">1</span>
</pre></div>
</div>
<p>To set the USB configuration to start enumeration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SET_USB_START_STATUS</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="features_audio.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Interfaces, Audio Routing and Filtering</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Product features</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2019-2021, XMOS Ltd
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="../../../_sources/doc/rst/features/features_booting.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">XVF3610 Features and Configuration</a><ul>
<li><a class="reference internal" href="#booting">Booting</a><ul>
<li><a class="reference internal" href="#flash-storage-structure">Flash storage structure</a></li>
<li><a class="reference internal" href="#programming-the-factory-boot-image-and-data-partition">Programming the Factory Boot image and Data Partition</a></li>
<li><a class="reference internal" href="#upgrade-images-and-data-partitions">Upgrade Images and Data Partitions</a><ul>
<li><a class="reference internal" href="#generation-of-binary-upgrade-image">Generation of Binary Upgrade image</a></li>
<li><a class="reference internal" href="#addition-of-dfu-suffix-to-binary-files">Addition of DFU Suffix to Binary files</a></li>
<li><a class="reference internal" href="#performing-dfu">Performing DFU</a></li>
</ul>
</li>
<li><a class="reference internal" href="#factory-restore">Factory restore</a></li>
<li><a class="reference internal" href="#boot-image-and-data-partition-compatibility-checks">Boot Image and Data Partition Compatibility checks</a></li>
<li><a class="reference internal" href="#custom-flash-memory-devices">Custom flash memory devices</a><ul>
<li><a class="reference internal" href="#custom-flash-definition-for-factory-programming">Custom flash definition for factory programming</a></li>
<li><a class="reference internal" href="#custom-flash-definition-for-data-partition-generation">Custom flash definition for Data Partition generation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#spi-slave-boot">SPI Slave Boot</a><ul>
<li><a class="reference internal" href="#spi-boot-of-xvf3610-int-using-development-kit-and-raspberry-pi">SPI Boot of XVF3610-INT using Development Kit and Raspberry Pi</a></li>
<li><a class="reference internal" href="#spi-boot-of-xvf3610-ua-using-development-kit-and-raspberry-pi">SPI Boot of XVF3610-UA using Development Kit and Raspberry Pi</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#configuration-and-the-data-partition">Configuration and the Data Partition</a><ul>
<li><a class="reference internal" href="#data-partition-definition">Data Partition definition</a><ul>
<li><a class="reference internal" href="#partition-file-structure">Partition file structure</a></li>
<li><a class="reference internal" href="#item-files">Item files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#generating-a-data-partition-for-custom-applications">Generating a Data Partition for custom applications</a></li>
<li><a class="reference internal" href="#serial-number">Serial Number</a><ul>
<li><a class="reference internal" href="#usb-device-enumeration-xvf3610-ua-only">USB device enumeration (XVF3610-UA only)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/tabs.js"></script>
    <script src="../../../_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>