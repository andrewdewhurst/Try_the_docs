<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" /><link rel="next" title="Principles of configuration, control and usage" href="control_interface.html" /><link rel="prev" title="XVF3610 System Architecture" href="architecture.html" />

    <meta name="generator" content="sphinx-3.5.4, furo 2021.04.11.beta34"/>
        <title>XVF3610 Voice Processing Pipeline - XVF3610 2.0.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/styles/furo.css?digest=59ab60ac09ea94ccfe6deddff6d715cce948a6fc">
    <link rel="stylesheet" href="../../../_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../../../_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" href="../../../_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">XVF3610 2.0.0 documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../../_static/xmos_logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">XVF3610 2.0.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../before_you_start.html">Before you start</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../LICENSE.html">XMOS PUBLIC LICENCE: Version 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../COPYRIGHTS.html">Copyright</a></li>
<li class="toctree-l2"><a class="reference internal" href="../version_info.html">Tool and Architecture Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../CHANGELOG.html">lib_xud Change Log</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">XVF3610 Product description</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">XVF3610 Far-field voice processor</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html">XVF3610 System Architecture</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">XVF3610 Voice Processing Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="control_interface.html">Principles of configuration, control and usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="firmware_package.html">Firmware release package</a></li>
<li class="toctree-l2"><a class="reference internal" href="firmware_package.html#required-tools">Required Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="firmware_package.html#command-line-interface-vfctrl">Command-line interface (vfctrl)</a></li>
<li class="toctree-l2"><a class="reference internal" href="firmware_package.html#configuration-via-control-interface">Configuration via Control interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="development_kits.html">Development kits</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../features/index.html">Product features</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../features/features_booting.html">XVF3610 Features and Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/features_audio.html">Interfaces, Audio Routing and Filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/features_audio.html#far-field-voice-processing">Far-Field Voice Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/features_interfaces.html">I2C Slave Control interface (XVF3610-INT only)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/features_interfaces.html#general-purpose-input-and-output-and-peripheral-bridging">General Purpose Input and Output and Peripheral Bridging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/features_interfaces.html#gpio">GPIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/features_interfaces.html#i2c-master-peripheral-interface-xvf3610-ua-only">I2C Master peripheral interface (XVF3610-UA Only)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/features_interfaces.html#spi-master">SPI Master</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/features_usb.html">USB Interface</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference/index.html">Reference information</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/XVF3610_parameter_summary.html">Parameter summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/Boot_Status_codes.html">Boot status codes (RUN_STATUS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/Example_SPISPEC.html">Example .SPISPEC file format</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/SPI_Booting_of_XVF3610-UA_dev_kit.html">SPI Boot custom connection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/USB_Enumeration_data.html">USB enumeration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/USB-HID_example.html">USB HID - Example using the development kit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/General_purpose_filter_example.html">General purpose filter example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/Control_parameter_protocol.html">Command transport protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/Flash_programming_flow.html">Flash programming and update flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/Capturing_packed_samples.html">Capturing packed samples for system integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/Command_table.html">Command list</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../other_resources/index.html">Additional Information</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../other_resources/documentation.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other_resources/firmware.html">Device firmware and software</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../other_resources/index.html#revision-history">Revision History</a></li>
</ul>

</div>

    <select name="version" id="version-select" value="Latest" onchange="changeVersion(this.value)" >
    <option selected disabled>Other versions</option>
    <option value="html/v1/">v1</option>
    <option value="html/v2.0.0/">v2.0.0</option>
    <option value="html/latest/">latest</option>
    </select>

    <script>
    function changeVersion(val) {
        var loc = window.location.toString();
        var i = loc.indexOf("html/");
        if (i >= 0) {
            var s1 = loc.substring(0, i);
            var i2 = loc.indexOf("/", i+6)
            var s2 = loc.substring(i2+1);
            nl=s1.concat(val, s2);


            var request = new XMLHttpRequest();  
            request.open('GET', nl, true);
            request.onreadystatechange = function(){
            if (request.readyState === 4){
                if (request.status === 404) {  
                    alert("Oh no, it does not exist!");
                    window.location.assign(loc);
                    location.reload();
                }
                else {
                    window.location.assign(nl);
                }  
            }
        };
        request.send();    
        }
    }
    </script>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="xvf3610-voice-processing-pipeline">
<h1>XVF3610 Voice Processing Pipeline<a class="headerlink" href="#xvf3610-voice-processing-pipeline" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The core of the XVF3610 voice processor is a high-performance audio
processing pipeline that takes its input from a pair of the microphone
and executes a series of signal processing algorithms to extract a voice
signal from a complex soundscape. The audio pipeline can accept a
reference signal from a host system which is used to perform Acoustic
Echo Cancellation (AEC) to remove audio being played by the host. The
audio pipeline provides two different output channels - one that is
optimized for Automatic Speech Recognition systems and the other for
voice communications.</p>
<p>Flexible audio signal routing infrastructure and a range of digital
inputs and outputs enable the XVF3610 to be integrated into a wide range
of system configurations, that can be configured at start up and during
operation through a set of control registers.</p>
<p>In addition, the XVF3610-UA variant supports a standard USB PHY
interface which supports a UAC audio device and device control over USB.
The following sections describe the voice pipeline and the surrounding
infrastructure in more detail.</p>
</div>
<div class="section" id="audio-processing-pipeline">
<h2>Audio Processing Pipeline<a class="headerlink" href="#audio-processing-pipeline" title="Permalink to this headline">¶</a></h2>
<p>The audio processing pipeline is common to both the XVF3610-UA and
XVF3610-INT firmware variants. The signal processing chain is described
below, with individual blocks and usage described in more detail in
subsequent sections.</p>
<p>The XVF3610 audio processing pipeline takes inputs from a pair of MEMS
Pulse Density Modulation (PDM) microphones and uses advanced signal
processing to create audio streams suitable for use in Automatic Speech
Recognition (ASR) and voice communication applications. The pipeline
enhances the captured audio stream using a set of complementary signal
enhancement and noise reduction processes.</p>
<div class="figure align-default" id="id1">
<img alt="../../../_images/image4.png" src="../../../_images/image4.png"/>
<p class="caption"><span class="caption-number">Fig. 4 </span><span class="caption-text">The XVF3610 audio pipeline</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>The pipeline takes its input from a pair of low-cost PDM microphones and
converts this signal to PCM for further processing:</p>
<ul class="simple">
<li><p><strong>Acoustic Echo Cancellation (AEC):</strong> Continuously modelling the room
acoustics allows the AEC to remove audio being played into the
room by the product which the XVF3610 is a component of. A
reference copy of the audio is provided to the AEC in order for it
to accurately estimate the echo.</p></li>
<li><p><strong>Automatic Delay Estimation &amp; Control (ADEC):</strong> Automatically
monitors and automatically compensates for the delay between the
reference audio and the echo received by the microphone.</p></li>
</ul>
<p>Following echo cancellation, the ASR and communications paths diverge to
permit parameter tuning appropriate for the individual audio output use
cases.</p>
<ul class="simple">
<li><p><strong>Interference Cancellation (IC):</strong> Suppresses static noise from
point sources such as cooker hoods, washing machines, or radios
for which there is no reference audio signal available.</p></li>
<li><p><strong>Voice Activity Detection (VAD):</strong> Controls adaption the IC and AGC
to optimise output for near-end speech.</p></li>
<li><p><strong>Noise Suppression (NS):</strong> Suppresses diffuse noise from sources
whose frequency characteristics do not change rapidly over time
(i.e., diffuse stationary noise).</p></li>
<li><p><strong>Automatic Gain Control (AGC):</strong> Controls the audio output level via
separate AGC channels for Automatic Speech Recognition (ASR) and
communications output. The VAD is used to prevent gain changes
during speech to improve speech recognition performance.</p></li>
</ul>
<p>The pipeline has been designed to minimise the need to tune and modify
these functions. However, if required for specific use cases, these
later sections of this document provide details of the relevant
parameters and processes.</p>
</div>
<div class="section" id="asr-and-communication-processing">
<h2>ASR and Communication Processing<a class="headerlink" href="#asr-and-communication-processing" title="Permalink to this headline">¶</a></h2>
<p>The audio pipeline discussed above produces two separate audio streams,
one specifically tuned for integration with keyword and ASR services and
the other designed for conferencing and communication applications. Both
processed audio streams are available simultaneously on the left and
right channels of the USB and I2S audio outputs. The default
configuration is as follows:</p>
<div class="table-wrapper"><table class="colwidths-auto docutils align-default" id="id2">
<caption><span class="caption-number">Table 2 </span><span class="caption-text">Default channel mapping (both USB and I2S)</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Channel</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>[0] - Left</p></td>
<td><p>ASR</p></td>
</tr>
<tr class="row-odd"><td><p>[1] - Right</p></td>
<td><p>Communications</p></td>
</tr>
</tbody>
</table></div>
<p>In situations where an ASR is used to invoke a call it may be necessary
to continually monitor the ASR channel for a ‘end call’ intent. The
parallel output of both ASR and Communications processed streams allow
the combination of high-quality calling audio with the tuned ASR
capability.</p>
<p>The IO_MAP configuration parameter (see <em>Signal flow and processing</em>
section) allows users to also configure both channels to be ASR or
Communications if required.</p>
</div>
<div class="section" id="xvf3610-int-for-integrated-voice-interface-applications">
<h2>XVF3610-INT - For integrated voice interface applications<a class="headerlink" href="#xvf3610-int-for-integrated-voice-interface-applications" title="Permalink to this headline">¶</a></h2>
<p>The XVF3610-INT product embeds the core audio processing pipeline in an
audio infrastructure that supports rate conversion, filtering and signal
routing. This infrastructure is controllable by the host system via a
set of control registers. In addition, the XVF3610-INT provides a set of
peripheral interfaces to the host system to other devices, eg digital
inputs, LEDs, SPI peripherals etc.</p>
<p>The peripheral interfaces supported include an interface to an optional
QSPI Flash device containing the XVF3610 firmware and configuration
information that is loaded by the processor on startup.</p>
<p>The system architecture of the XVF3610-INT is shown below.</p>
<div class="figure align-default" id="id3">
<img alt="../../../_images/image5.png" src="../../../_images/image5.png"/>
<p class="caption"><span class="caption-number">Fig. 5 </span><span class="caption-text">XVF3610-INT System architecture</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="xvf3610-ua-for-usb-accessory-voice-interface-applications">
<h2>XVF3610-UA - For USB accessory voice interface applications<a class="headerlink" href="#xvf3610-ua-for-usb-accessory-voice-interface-applications" title="Permalink to this headline">¶</a></h2>
<p>The XVF3610-UA variant includes the same audio infrastructure as the
XFV3610-INT, but it includes a USB interface that implements a UAC1.0
audio device to interface to the host system. The USB interface also
supports an Endpoint 0 control channel, and a USB HID to signal input
events to the host.</p>
<p>The system architecture of the XVF3610-UA is shown below.</p>
<div class="figure align-default" id="id4">
<img alt="../../../_images/image6.png" src="../../../_images/image6.png"/>
<p class="caption"><span class="caption-number">Fig. 6 </span><span class="caption-text">XVF3610-UA System architecture</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<p>NOTE: The XVF3610-UA product also supports a hybrid mode of operation
where the reference signal is delivered via I2S rather than USB. This
mode is selected via modification of the configuration data stored in
the flash device.</p>
</div>
</div>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="control_interface.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Principles of configuration, control and usage</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="architecture.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">XVF3610 System Architecture</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2019-2021, XMOS Ltd
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="../../../_sources/doc/rst/overview/audio_pipeline.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">XVF3610 Voice Processing Pipeline</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#audio-processing-pipeline">Audio Processing Pipeline</a></li>
<li><a class="reference internal" href="#asr-and-communication-processing">ASR and Communication Processing</a></li>
<li><a class="reference internal" href="#xvf3610-int-for-integrated-voice-interface-applications">XVF3610-INT - For integrated voice interface applications</a></li>
<li><a class="reference internal" href="#xvf3610-ua-for-usb-accessory-voice-interface-applications">XVF3610-UA - For USB accessory voice interface applications</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/tabs.js"></script>
    <script src="../../../_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>