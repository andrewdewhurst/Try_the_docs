<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" /><link rel="next" title="Development kits" href="development_kits.html" /><link rel="prev" title="Principles of configuration, control and usage" href="control_interface.html" />

    <meta name="generator" content="sphinx-3.5.4, furo 2021.04.11.beta34"/>
        <title>Firmware release package - NO PROJECT DEFINED NO VERSION DEFINED documentation</title>
      <link rel="stylesheet" href="../../../_static/styles/furo.css?digest=59ab60ac09ea94ccfe6deddff6d715cce948a6fc">
    <link rel="stylesheet" href="../../../_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../../../_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" href="../../../_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">NO PROJECT DEFINED NO VERSION DEFINED documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../../_static/xmos_logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">NO PROJECT DEFINED NO VERSION DEFINED documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../before_you_start.html">Before you start</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../LICENSE.html">XMOS PUBLIC LICENCE: Version 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../COPYRIGHTS.html">Copyright</a></li>
<li class="toctree-l2"><a class="reference internal" href="../version_info.html">Tool and Architecture Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../CHANGELOG.html">lib_xud Change Log</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">XVF3610 Product description</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">XVF3610 Far-field voice processor</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html">XVF3610 System Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="audio_pipeline.html">XVF3610 Voice Processing Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="control_interface.html">Principles of configuration, control and usage</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Firmware release package</a></li>
<li class="toctree-l2"><a class="reference internal" href="#required-tools">Required Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="#command-line-interface-vfctrl">Command-line interface (vfctrl)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-via-control-interface">Configuration via Control interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="development_kits.html">Development kits</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../features/index.html">Product features</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../features/features_booting.html">XVF3610 Features and Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/features_audio.html">Interfaces, Audio Routing and Filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/features_audio.html#far-field-voice-processing">Far-Field Voice Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/features_interfaces.html">I2C Slave Control interface (XVF3610-INT only)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/features_interfaces.html#general-purpose-input-and-output-and-peripheral-bridging">General Purpose Input and Output and Peripheral Bridging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/features_interfaces.html#gpio">GPIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/features_interfaces.html#i2c-master-peripheral-interface-xvf3610-ua-only">I2C Master peripheral interface (XVF3610-UA Only)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/features_interfaces.html#spi-master">SPI Master</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/features_usb.html">USB Interface</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference/index.html">Reference information</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/XVF3610_parameter_summary.html">Parameter summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/Boot_Status_codes.html">Boot status codes (RUN_STATUS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/Example_SPISPEC.html">Example .SPISPEC file format</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/SPI_Booting_of_XVF3610-UA_dev_kit.html">SPI Boot custom connection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/USB_Enumeration_data.html">USB enumeration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/USB-HID_example.html">USB HID - Example using the development kit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/General_purpose_filter_example.html">General purpose filter example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/Control_parameter_protocol.html">Command transport protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/Flash_programming_flow.html">Flash programming and update flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/Capturing_packed_samples.html">Capturing packed samples for system integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/Command_table.html">Command list</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../other_resources/index.html">Additional Information</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../other_resources/documentation.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other_resources/firmware.html">Device firmware and software</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../other_resources/index.html#revision-history">Revision History</a></li>
</ul>

</div>

    <select name="version" id="version-select" value="Latest" onchange="changeVersion(this.value)" >
    <option selected disabled>Other versions</option>
    <option value="html/v1/">v1</option>
    <option value="html/latest/">latest</option>
    </select>

    <script>
    function changeVersion(val) {
        var loc = window.location.toString();
        var i = loc.indexOf("html/");
        if (i >= 0) {
            var s1 = loc.substring(0, i);
            var i2 = loc.indexOf("/", i+6)
            var s2 = loc.substring(i2+1);
            nl=s1.concat(val, s2);


            var request = new XMLHttpRequest();  
            request.open('GET', nl, true);
            request.onreadystatechange = function(){
            if (request.readyState === 4){
                if (request.status === 404) {  
                    alert("Oh no, it does not exist!");
                    window.location.assign(loc);
                    location.reload();
                }
                else {
                    window.location.assign(nl);
                }  
            }
        };
        request.send();    
        }
    }
    </script>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="firmware-release-package">
<h1>Firmware release package<a class="headerlink" href="#firmware-release-package" title="Permalink to this headline">¶</a></h1>
<p>There are two release packages available for the XVF3610, one for the
XVF3610-UA and one for the XVF3610-INT.</p>
<p>Release packages and firmware builds are identified via a version
number, which follows the standard semantic version specification. The
version number format is X.Y.Z, eg 5.2.0, and these numbers have the
following meaning.</p>
<div class="table-wrapper"><table class="colwidths-auto docutils align-default" id="id2">
<caption><span class="caption-number">Table 3 </span><span class="caption-text">Firmware version number structure</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Digit</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>X</p></td>
<td><p>Major version number</p></td>
<td><p>Significant release of the firmware. The control interface may not be backwards compatible with earlier versions</p></td>
</tr>
<tr class="row-odd"><td><p>Y</p></td>
<td><p>Minor version number</p></td>
<td><p>New features added, but the control interface is backwards compatible with earlier host applications</p></td>
</tr>
<tr class="row-even"><td><p>Z</p></td>
<td><p>Patch version number</p></td>
<td><p>Bug fixes for incorrect functionality only. No change to host interface</p></td>
</tr>
</tbody>
</table></div>
<p>The release version is contained in the file name of firmware file
distribution and can also be read via the control interface using the
<code class="docutils literal notranslate"><span class="pre">GET_VERSION</span></code> command.</p>
<p>Each package consists of several directories and files containing
released firmware binaries, data-partition tools, host binaries and host
source code. A simplified directory structure is shown below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├── bin
├── data-partition
│ ├── images
│ └── input
└── host
├── Linux
│   └── bin
├── MAC
│   └── bin
├── Pi
│   ├── bin
│   └── scripts
├── Win32
│   └── bin
└── src
├── dfu
├── dpgen
└── vfctrl
</pre></div>
</div>
<p>Further information about each component of the release is as follows:</p>
<div class="section" id="bin-directory">
<h2>“bin” Directory<a class="headerlink" href="#bin-directory" title="Permalink to this headline">¶</a></h2>
<p>This directory contains the released firmware for the XVF3610. There are
two copies of the firmware; one intended for loading from an external
flash device and one for loading from an external host over SPI (XVF3610
is the slave). Please refer to the SPI Slave boot section of the
datasheet for connections to the external boot source.</p>
</div>
<div class="section" id="data-partition-directory">
<h2>“data-partition” Directory<a class="headerlink" href="#data-partition-directory" title="Permalink to this headline">¶</a></h2>
<p>The data partition contains configuration data for the XVF3610 firmware,
implemented as a set of commands that are run at boot time. The data
partition is created using input command source files and a set of tools
which are described in the Data Partition section of this document. The
contents of the data-partition directory are as follows:</p>
<p>The root directory contains default data partition image source files
(int.json or ua.json) as well as the generic flash device specification
16mbit_12.5mhz_sector_4kb.spispec, data partition generation scripts and
short instructions about how to generate data partition binary files.</p>
<ul class="simple">
<li><p>The images subdirectory contains pre-generated data partition binary
files generated from the default data partition image source file.
These files are suitable for direct programming into the external
flash along with the firmware, should the default settings be
suitable.</p></li>
<li><p>The input subdirectory contains short command sequences which are
referenced by the data partition image source file when the data
partition binary file is generated.</p></li>
</ul>
<p>In addition, an output directory is created during the running of the
data partition generation script which contains the newly generated data
partition binary file.</p>
</div>
<div class="section" id="host-directory">
<h2>“host” Directory<a class="headerlink" href="#host-directory" title="Permalink to this headline">¶</a></h2>
<p>This directory contains files and utilities relating to the host. The
various host utilities that perform parameter control, DFU and data
partition generation are provided pre-compiled for Linux (ARM and x86),
Windows and MacOS platforms. These binaries can be found in the Linux,
Pi, Mac and Win32 directories along with an additional script in for the
Pi release called send_image_from_rpi.py which provides an example of
sending an SPI boot image from the host.</p>
<p>The root of the host directory also contains scripts for unpacking
packed signals which can be captured using the controls described in the
signal routing section of this document.</p>
<p>Instructions for building the host utilities from the source are also
provided in the same directory. The source files for the host utilities
are contained in the src sub-directory allowing building, modification
or integration into other projects.</p>
<p>Within this directory there are three further sub-directories dfu, dpgen
and vfctrl which contain the source files (and dependent libraries) for
the DFU, data partition generator and parameter control utilities.</p>
</div>
</div>
<div class="section" id="required-tools">
<h1>Required Tools<a class="headerlink" href="#required-tools" title="Permalink to this headline">¶</a></h1>
<p>In order to update the firmware, modify and regenerate Data Partitions
and rebuild the host utilities the following tools are required.</p>
<div class="section" id="xtc-tools">
<h2>XTC Tools<a class="headerlink" href="#xtc-tools" title="Permalink to this headline">¶</a></h2>
<p>The XMOS XTC Tools contains a comprehensive suite of tools for
compilation, debug and programming of XMOS devices. It is available to
download <a class="reference external" href="https://www.xmos.ai/software-tools">https://www.xmos.ai/software-tools</a></p>
<p>NOTE: At the time of writing v14.4.1 of the XTC Tools tools is
recommend for XVF3610 operation.</p>
<p>More recent versions may be available, but unless specified on the
xmos.ai website they will not have been tested and verified for
operation with XVF3610.</p>
<p>Further information about the full tool suite, including installation
instructions for different platforms is available here in the
XTC Tools user guide, available from <a class="reference external" href="https://www.xmos.ai/file/tools-user-guide">https://www.xmos.ai/file/tools-user-guide</a></p>
<p>The XVF3610 Voice Processor is provided in two pre-compiled builds (-UA
and -INT) and as such only requires the usage of the XTC Tools
programming tools, specifically xFLASH. This operates as a command-line
application, to create the boot image, and if using flash, program the
boot image to the attached device.</p>
<p>An XTAG debugger must be connected to the XVF3610 for flash programming
operations. Refer to the Development Kit User Guide for information on
using XTAG connections to XVF3610 development kits.</p>
<p>The basic form of the xFLASH command for flash image creation and
programming with a data partition is as follows (note multiple lines
have been used for clarity, but command should be executed on single line).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>xflash --boot-partition-size <span class="m">1048576</span> --factory <span class="o">[</span>Application executable <span class="o">(</span>.xe<span class="o">)]</span> --data <span class="o">[</span>Data partition description <span class="o">(</span>.bin<span class="o">)]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For boot over SPI from a host processor uses a specific image which
is supplied in the release package.  No data partition is included as
configuration command are assumed to be supplied by the host controller used.</p>
</div>
<ul class="simple">
<li><p>Application executable (.xe)
The .xe file is a boot image provided with a VocalFusion release package in
one of the supported configurations (-UA or -INT product variants).</p></li>
<li><p>Data partition description (.bin)
The .bin file is a data partition description either supplied in the release
package (-UA or -INT) or customised as described later in this guide.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Running XTC Tools on macOS Catalina or above triggers a security alert.
The process to resolve this is detailed here :
<a class="reference external" href="https://www.xmos.ai/file/running-XTimecomposer-on-macos-catalina/">https://www.xmos.ai/file/running-XTimecomposer-on-macos-catalina/</a></p>
</div>
</div>
<div class="section" id="python-3">
<h2>Python 3<a class="headerlink" href="#python-3" title="Permalink to this headline">¶</a></h2>
<p>Some operations, such as running the SPI boot example on the Raspberry
Pi, require the use of Python 3 (v3.7 onward is recommended). Python can
be downloaded from <a class="reference external" href="http://python.org/downloads">http://python.org/downloads</a>.</p>
</div>
<div class="section" id="host-build-tools">
<h2>Host build tools<a class="headerlink" href="#host-build-tools" title="Permalink to this headline">¶</a></h2>
<p>In order to build the host utilities, the use of a platform-specific
compiler is required.</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--0-input--1" name="tab-set--0" type="radio"/><label class="tab-label" for="tab-set--0-input--1">Windows</label><div class="tab-content docutils container">
<p>The host utilities are built with the <em>x86 Native Tools Command Prompt
for VS</em> which is installed as part of the <em>Build Tools for Visual
Studio.</em> This can be downloaded from Microsoft website (at the time of
writing latest versions available here:
<a class="reference external" href="https://visualstudio.microsoft.com/downloads/#build-tools-for-visual-studio-2019">https://visualstudio.microsoft.com/downloads/#build-tools-for-visual-studio-2019</a>).
It is important to ensure that the optional <em>C++ CMake tools for
Windows</em> are included when setting up the installation.</p>
</div>
<input class="tab-input" id="tab-set--0-input--2" name="tab-set--0" type="radio"/><label class="tab-label" for="tab-set--0-input--2">Linux</label><div class="tab-content docutils container">
<p>Depending on the distribution and version of Linux used, the following
packages may need to be installed:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt-get install -y build-essential
sudo apt-get install -y pkg-config
sudo apt-get install -y libusb-1.0-0-dev
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--0-input--3" name="tab-set--0" type="radio"/><label class="tab-label" for="tab-set--0-input--3">Mac OS</label><div class="tab-content docutils container">
<p>The XCode Command Line tools are required to build in on macOS. The
following command can be used to install the tools.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>xcode-select --install
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="command-line-interface-vfctrl">
<h1>Command-line interface (vfctrl)<a class="headerlink" href="#command-line-interface-vfctrl" title="Permalink to this headline">¶</a></h1>
<p>To allow command-line access to the control interface on the XVF3610
processor, the <strong>vfctrl</strong> (<strong>V</strong>ocal<strong>F</strong>usion
<strong>C</strong>on<strong>tr</strong>o<strong>l</strong>) utility is provided as part of the release
package. This utility</p>
<p>Two versions of this utility are provided for control of the device (a
third is used internally by the Data Partition generation process):</p>
<div class="table-wrapper"><table class="colwidths-auto docutils align-default" id="id3">
<caption><span class="caption-number">Table 4 </span><span class="caption-text">vfctrl versions and platforms</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Function</p></th>
<th class="head"><p>Host platforms supported</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>vfctrl_usb</p></td>
<td><p>Control of XVF3610-UA over a USB interface</p></td>
<td><p>Windows, MacOS, Linux, Raspberry Pi OS</p></td>
</tr>
<tr class="row-odd"><td><p>vfctrl_i2c</p></td>
<td><p>Control of XVF3610-INT over i2c interface</p></td>
<td><p>Raspberry Pi OS</p></td>
</tr>
</tbody>
</table></div>
<p>Source code for the utility is also provided for compilation for other
host devices if required.</p>
<p>The general syntax of the command line tool, when used for device
control, is as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vfctrl_usb &lt;COMMAND_VERB&gt; <span class="o">[</span> arg <span class="m">1</span><span class="o">]</span> <span class="o">[</span>arg <span class="m">2</span><span class="o">]</span>....<span class="o">[</span>arg N<span class="o">]</span> <span class="o">[</span><span class="se">\#</span> Comment<span class="o">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;COMMAND_VERB&gt;</span></code> is required and is used to control the parameters of
the device. Commands can be read and write commands and are
distinguished by the prefix <code class="docutils literal notranslate"><span class="pre">GET\_</span></code> and <code class="docutils literal notranslate"><span class="pre">SET\_</span></code> for parameter read and
write respectively.</p>
<p>The available commands are described in detail in specific sections
later in this document, and a summary table of all the parameters is
provided in Appendix A.</p>
<p>Following the &lt;COMMAND_VERB&gt; there are a number of optional arguments
[arg 1]..[arg N] which depend on the specific parameter. These are
detailed in the command tables later in the document.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">&lt;COMMAND_VERB&gt;`</span> <span class="pre">is</span> <span class="pre">a</span> <span class="pre">``GET\_</span></code> command, the output of the operation
is printed to the terminal as in the example below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vfctrl_usb GET_GPI
GET_GPI: <span class="m">13</span>
</pre></div>
</div>
<p>The number and type of arguments depend on the command and these are
detailed in the command tables. Arguments are integer numbers separated
by a space. For setting some parameters that require floating-point
data, the numbers have to be first converted to a Q format and then
transferred as integers.</p>
<p>The specification of the Q format for representing floating-point
numbers is given in Appendix H.</p>
<p>A secondary form of vfctrl is also available which provides information
for developers</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vfctrl <span class="o">[</span>options<span class="o">]</span>
</pre></div>
</div>
<p>Where [options] can be:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-h, --help : List all <span class="nb">command</span> options

-d, --dump-params : Print list of parameter values

-n, --no-check-version : Do not check version of firmware image
</pre></div>
</div>
</div>
<div class="section" id="configuration-via-control-interface">
<h1>Configuration via Control interface<a class="headerlink" href="#configuration-via-control-interface" title="Permalink to this headline">¶</a></h1>
<p>The XVF3610 Voice Processor contains parameters which can be read and
written by the host processor at run time. For information writing
parameters at boot time for initial configuration, please see the
section on the Data Partition later in this document.</p>
<p>The XVF3610 firmware is provided as two pre-compiled builds, -UA and
-INT, which provide a parameter control mechanism over USB endpoint 0
and I2C respectively.</p>
<p>Device functions have controllable parameters for the audio pipeline,
GPIO, sample rate settings, audio muxing, timing and general device
setup and adjustment. Commands support either read using the GET_
prefix or write using the SET_ prefix. Controllable parameters may
either be readable and writeable, read-only or write-only. Various data
types are supported including signed/unsigned integer of either 8b or
32b, fixed point signed/unsigned and floating-point.</p>
<p>In addition, the -UA build includes volume controls for input (processed
mic from XVF3610) and output (far-end reference signal). These are USB
Audio Class 1.0 compliant controls and are accessed via the host OS
audio control panel instead of the XVF3610 control interface. The
volumes are initialised to 100% (0dB attenuation) on device power up,
which is the recommended setting.</p>
<p>Ensure that the XVF3610-UA USB Audio input and output volume controls on
the host are set to 100% (no attenuation) to ensure proper operation of
the device. Some host OS (eg. Windows) may store volume setting in
between device connections.</p>
<p>For a comprehensive list of parameters, their data types and an
understanding of their function within the device please consult the
User Guide section relevant to the function of interest, or Appendix A
which summarises all the commands. The control utility can also be used
by supplying the -h argument to the command line. This dumps a list of
commands to the console along with a brief description of the function
of each command. The remainder of this section will cover the generic
operation of the control interface.</p>
<div class="section" id="control-operation">
<h2>Control operation<a class="headerlink" href="#control-operation" title="Permalink to this headline">¶</a></h2>
<p>The control interface works by sending a message from the host to the
control process within the XVF3610 device. The time required to execute
commands can vary, but most will respond within 30ms. Since the commands
are fully acknowledged, by design, the control utility blocks until
completion. This interface is designed to allow real-time tuning and
adjustment but may stall due to bus access or data retrieval.</p>
<p>The control interface consists of two parts a host side application and
the device application. These are briefly summarised below.</p>
</div>
<div class="section" id="host-application">
<h2>Host Application<a class="headerlink" href="#host-application" title="Permalink to this headline">¶</a></h2>
<p>The example host applications, found in the /host directory in the
Release Package, are command-line utilities that accept text commands
and, in the case of a read, provides a text response containing the read
parameter(s). Full acknowledgement is included in the protocol and an
error is returned in the case of the command not being executed properly
or handled correctly by the device.</p>
<p>Example host source code and makefiles for are provided in the release
package for x86 Linux, ARM Linux (Raspberry Pi), Windows and Mac
platforms along with pre-compiled executables to allow fast evaluation
and integration. For more information refer to the <em>Building the host
utilities from source code</em> section.</p>
</div>
<div class="section" id="device-application">
<h2>Device Application<a class="headerlink" href="#device-application" title="Permalink to this headline">¶</a></h2>
<p>The device is always ready to receive commands. The device includes
command buffering and an asynchronous mechanism which means that
Endpoint 0, NACKing for USB or clock stretching for I2C is not required.
This simplifies the host requirements particularly in the cases where
clock stretching is not supported by the host I2C peripheral.</p>
<div class="section" id="configuration-via-data-partition">
<h3>Configuration via Data Partition<a class="headerlink" href="#configuration-via-data-partition" title="Permalink to this headline">¶</a></h3>
<p>VocalFusion device flash firmware configuration is comprised of a Boot
image and a Data Partition.</p>
<ul class="simple">
<li><p>The <strong>Boot image</strong> in the form of an .xe archive is the executable
code. It is provided as part of the XVF3610-UA or XVF3610-INT
Release Package. This configures the underlying operation of the
device.</p></li>
<li><p>The <strong>Data Partition</strong> configures a running Boot image instance at
startup with a set of commands which are customisable for the
specific application. This contains any command that can be issued
at run-time via USB or I<sup>2</sup>C, plus some more that are
boot-time only. Pre-configured Data Partitions are supplied in the
release packages for default operation.</p></li>
</ul>
<p>This combination of Boot image and Data Partition allow the
functionality of the processor to be configured and defined without
requiring any modification or recompilation of base firmware. The
commands discussed in subsequent sections can be stored in the Data
Partition, for execution at startup redefining the default operation of
the device.</p>
</div>
</div>
</div>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="development_kits.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Development kits</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="control_interface.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Principles of configuration, control and usage</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2019-2021, XMOS Ltd
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="../../../_sources/doc/rst/overview/firmware_package.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Firmware release package</a><ul>
<li><a class="reference internal" href="#bin-directory">“bin” Directory</a></li>
<li><a class="reference internal" href="#data-partition-directory">“data-partition” Directory</a></li>
<li><a class="reference internal" href="#host-directory">“host” Directory</a></li>
</ul>
</li>
<li><a class="reference internal" href="#required-tools">Required Tools</a><ul>
<li><a class="reference internal" href="#xtc-tools">XTC Tools</a></li>
<li><a class="reference internal" href="#python-3">Python 3</a></li>
<li><a class="reference internal" href="#host-build-tools">Host build tools</a></li>
</ul>
</li>
<li><a class="reference internal" href="#command-line-interface-vfctrl">Command-line interface (vfctrl)</a></li>
<li><a class="reference internal" href="#configuration-via-control-interface">Configuration via Control interface</a><ul>
<li><a class="reference internal" href="#control-operation">Control operation</a></li>
<li><a class="reference internal" href="#host-application">Host Application</a></li>
<li><a class="reference internal" href="#device-application">Device Application</a><ul>
<li><a class="reference internal" href="#configuration-via-data-partition">Configuration via Data Partition</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/tabs.js"></script>
    <script src="../../../_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>