<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" /><link rel="next" title="Flash programming and update flow" href="Flash_programming_flow.html" /><link rel="prev" title="General purpose filter example" href="General_purpose_filter_example.html" />

    <meta name="generator" content="sphinx-3.5.4, furo 2021.04.11.beta34"/>
        <title>Command transport protocol - NO PROJECT DEFINED NO VERSION DEFINED documentation</title>
      <link rel="stylesheet" href="../../../_static/styles/furo.css?digest=59ab60ac09ea94ccfe6deddff6d715cce948a6fc">
    <link rel="stylesheet" href="../../../_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../../../_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" href="../../../_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">NO PROJECT DEFINED NO VERSION DEFINED documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../../_static/xmos_logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">NO PROJECT DEFINED NO VERSION DEFINED documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../before_you_start.html">Before you start</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../LICENSE.html">XMOS PUBLIC LICENCE: Version 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../COPYRIGHTS.html">Copyright</a></li>
<li class="toctree-l2"><a class="reference internal" href="../version_info.html">Tool and Architecture Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../CHANGELOG.html">lib_xud Change Log</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../overview/index.html">XVF3610 Product description</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../overview/introduction.html">XVF3610 Far-field voice processor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/architecture.html">XVF3610 System Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/audio_pipeline.html">XVF3610 Voice Processing Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/control_interface.html">Principles of configuration, control and usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/firmware_package.html">Firmware release package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/firmware_package.html#required-tools">Required Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/firmware_package.html#command-line-interface-vfctrl">Command-line interface (vfctrl)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/firmware_package.html#configuration-via-control-interface">Configuration via Control interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/development_kits.html">Development kits</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../features/index.html">Product features</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../features/features_booting.html">XVF3610 Features and Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/features_audio.html">Interfaces, Audio Routing and Filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/features_audio.html#far-field-voice-processing">Far-Field Voice Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/features_interfaces.html">I2C Slave Control interface (XVF3610-INT only)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/features_interfaces.html#general-purpose-input-and-output-and-peripheral-bridging">General Purpose Input and Output and Peripheral Bridging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/features_interfaces.html#gpio">GPIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/features_interfaces.html#i2c-master-peripheral-interface-xvf3610-ua-only">I2C Master peripheral interface (XVF3610-UA Only)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/features_interfaces.html#spi-master">SPI Master</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/features_usb.html">USB Interface</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Reference information</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="XVF3610_parameter_summary.html">Parameter summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="Boot_Status_codes.html">Boot status codes (RUN_STATUS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="Example_SPISPEC.html">Example .SPISPEC file format</a></li>
<li class="toctree-l2"><a class="reference internal" href="SPI_Booting_of_XVF3610-UA_dev_kit.html">SPI Boot custom connection</a></li>
<li class="toctree-l2"><a class="reference internal" href="USB_Enumeration_data.html">USB enumeration</a></li>
<li class="toctree-l2"><a class="reference internal" href="USB-HID_example.html">USB HID - Example using the development kit</a></li>
<li class="toctree-l2"><a class="reference internal" href="General_purpose_filter_example.html">General purpose filter example</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Command transport protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="Flash_programming_flow.html">Flash programming and update flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="Capturing_packed_samples.html">Capturing packed samples for system integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="Command_table.html">Command list</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../other_resources/index.html">Additional Information</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../other_resources/documentation.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other_resources/firmware.html">Device firmware and software</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../other_resources/index.html#revision-history">Revision History</a></li>
</ul>

</div>

    <select name="version" id="version-select" value="Latest" onchange="changeVersion(this.value)" >
    <option selected disabled>Other versions</option>
    <option value="html/v1/">v1</option>
    <option value="html/latest/">latest</option>
    </select>

    <script>
    function changeVersion(val) {
        var loc = window.location.toString();
        var i = loc.indexOf("html/");
        if (i >= 0) {
            var s1 = loc.substring(0, i);
            var i2 = loc.indexOf("/", i+6)
            var s2 = loc.substring(i2+1);
            nl=s1.concat(val, s2);


            var request = new XMLHttpRequest();  
            request.open('GET', nl, true);
            request.onreadystatechange = function(){
            if (request.readyState === 4){
                if (request.status === 404) {  
                    alert("Oh no, it does not exist!");
                    window.location.assign(loc);
                    location.reload();
                }
                else {
                    window.location.assign(nl);
                }  
            }
        };
        request.send();    
        }
    }
    </script>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="command-transport-protocol">
<h1>Command transport protocol<a class="headerlink" href="#command-transport-protocol" title="Permalink to this headline">¶</a></h1>
<div class="section" id="transport-protocol-for-control-parameters">
<h2>Transport protocol for control parameters<a class="headerlink" href="#transport-protocol-for-control-parameters" title="Permalink to this headline">¶</a></h2>
<p>Control parameters are converted to an array of bytes in network byte
order (big endian) before they’re sent over the transport protocol. For
example, to set a control parameter to integer value 305419896 which
corresponds to hex 0x12345678, the array of bytes sent over the
transport protocol would be {0x12, 0x34, 0x56, 0x78}. Similarly, a 4
byte payload {0x00, 0x01, 0x23, 0x22} read over the transport protocol
is interpreted as an integer value 0x00012322.</p>
<p>In addition to the control parameters values, commands include Resource
ID, the Command ID and Payload Length fields that must be communicated
from the host to the device. The Resource ID is an 8-bit identifier that
identifies the resource within the device that the command is for. The
Command ID is an 8-bit identifier used to identify a command for a
resource in the device. Payload length is the length of the data in
bytes that the host wants to write to the device or read from the
device.</p>
<p>The payload length is interpreted differently for GET_ and SET_
commands. For SET_commands, the payload length is simply the number of
bytes worth of control parameters to write to the device. For example,
the payload length for a SET_ command to set a control parameter of
type int32 to a certain value, would be set to 4. For GET_ commands the
payload length is 1 more than the number of bytes of control parameters
to read from the device. For example, a GET_ command to read a
parameter of type int32, payload length would be set to 5. The one extra
byte is used for status and is the first byte (payload[0]) of the
payload received from the device. In the example above, payload[0] would
be the status byte and payload[1]..payload[4] would be the 4 bytes that
make up the value of the control parameter.</p>
<p>The table below lists the different values of the status byte and the
action the user is expected to take for each status:</p>
<div class="table-wrapper"><table class="docutils align-default">
<colgroup>
<col style="width: 9%"/>
<col style="width: 7%"/>
<col style="width: 84%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Re
turn
code</p></th>
<th class="head"><p>Va
lue</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ctrl
_done</p></td>
<td><p>0</p></td>
<td><p>Read command successful. The payload bytes contain
valid payload returned from the device</p></td>
</tr>
<tr class="row-odd"><td><p>ctrl
_wait</p></td>
<td><p>1</p></td>
<td><p>Read command not serviced. Retry until ctrl_done
status returned</p></td>
</tr>
<tr class="row-even"><td><p>ctrl
_inv
alid</p></td>
<td><p>3</p></td>
<td><p>Error in read command. Abort and debug</p></td>
</tr>
</tbody>
</table></div>
<div class="table-wrapper"><table class="colwidths-given docutils align-default" id="id1">
<caption><span class="caption-number">Table 16 </span><span class="caption-text">Values for retured status byte</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 15%"/>
<col style="width: 15%"/>
<col style="width: 70%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Return code</p></th>
<th class="head"><p>Values</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ctrl_done</p></td>
<td><p>0</p></td>
<td><p>Read command successful. The payload bytes contain valid payload returned from the device</p></td>
</tr>
<tr class="row-odd"><td><p>ctrl_wait</p></td>
<td><p>1</p></td>
<td><p>Read command not serviced. Retry until ctrl_done status returned</p></td>
</tr>
<tr class="row-even"><td><p>ctrl_invalid</p></td>
<td><p>3</p></td>
<td><p>Error in read command. Abort and debug</p></td>
</tr>
</tbody>
</table></div>
<p>The GET_commands need the extra status byte since the device might not
return the control parameter value immediately due to timing
constraints. If that is the case the status byte would indicate the
status as ctrl_wait and the user would need to retry the command. When
returned a ctrl_wait, the user is expected to retry the GET_ command
until the status is returned as ctrl_done. The first GET_command is
placed in a queue and it will be serviced by the end of each 15ms audio
frame. Once the status byte indicates ctrl_done, the rest of the bytes
in the payload indicate the control parameter value.</p>
</div>
<div class="section" id="transporting-control-parameters-over-i2c">
<h2>Transporting control parameters over I2C<a class="headerlink" href="#transporting-control-parameters-over-i2c" title="Permalink to this headline">¶</a></h2>
<p>This section describes the I2C command sequence when issuing read and
write commands to the device.</p>
<p>The first byte sent over I2C after start contains the device address and
information about whether this is an I2C read transaction or a write
transaction. This byte is 0x58 for a write command or 0x59 for a read
command. These values are derived by left shifting the device address
(0x2c) by 1 and doing a logical OR of the resulting value with 0 for an
I2C write and 1 for an I2C read.</p>
<p>The bytes sequence sent between I2C start and stop for SET_ commands is
shown in the figure below.</p>
<img alt="../../../_images/image28.png" src="../../../_images/image28.png"/>
<p>For GET_ commands, the I2C commands sequence consists of a write
command followed by a read command with a repeated start between the 2
commands. The write command writes the resource ID, command ID and the
expected data length to the device and the read command reads the status
byte followed by the rest of the payload that makes up the control
parameter value. The figure below shows the I2C bytes sequence sent and
received for a GET_ command.</p>
<img alt="../../../_images/image29.png" src="../../../_images/image29.png"/>
</div>
<div class="section" id="transporting-control-parameters-over-usb">
<h2>Transporting control parameters over USB<a class="headerlink" href="#transporting-control-parameters-over-usb" title="Permalink to this headline">¶</a></h2>
<p>Use the vendor_id 0x20b1, product_id 0x0014 and interface number 3 to
initialize for USB. The API function libusb_control_transfer() is used
for transporting over USB. When calling libusb_control_transfer(),
wIndex corresponds to the Resource ID, wValue is the Command ID and
wLength is the payload length.</p>
</div>
<div class="section" id="floating-point-to-fixed-point-q-format-conversion">
<h2>Floating point to fixed point (Q format) conversion<a class="headerlink" href="#floating-point-to-fixed-point-q-format-conversion" title="Permalink to this headline">¶</a></h2>
<p>Numbers with fractional parts can be represented as floating-point or
fixed-point numbers. Floating point formats are widely used but carry
performance overheads. Fixed point formats can improve system efficiency
and are used extensively within the XVF3610. Fixed point numbers have
the position of the decimal point fixed and this is indicated as a part
of the format description.</p>
<p>In this document, Q format is used to describe fixed point number
formats, with the representation given as Q<em>m</em>.<em>n</em> format where <em>m</em>
is the number of bits reserved for the sign and integer part of the
number and <em>n</em> is the number of bits reserved for the fractional part of
the number. The position of the decimal point is a trade-off between the
range of values supported and the resolution provided by the fractional
bits.</p>
<p>The dynamic range of Q<em>m</em>.<em>n</em> format is -2<sup>m-1</sup> and
2<sup>m-1</sup>-2<sup>-n</sup> with a resolution of 2<sup>-n</sup></p>
<p>To convert a floating-point format number to Q<em>m</em>.<em>n</em> format
fixed-point number:</p>
<ul class="simple">
<li><p>Multiply the floating-point number by 2<sup>m</sup></p></li>
<li><p>Round the result to the nearest integer</p></li>
<li><p>The resulting integer number is the Q<em>m</em>.<em>n</em> fixed-point
representation of the initial floating-point number</p></li>
</ul>
<p>To convert a Q<em>m</em>.<em>n</em> fixed-point number to floating-point:</p>
<ul class="simple">
<li><p>Divide the fixed-point number by 2<sup>m</sup></p></li>
<li><p>The resulting decimal number is a floating-point representation of
the fixed-point number.</p></li>
</ul>
<p>Converting a number into fixed point format and then back to a floating
point number may introduce an error of up to ±2<sup>-(n+1)</sup></p>
<p>Example:</p>
<p>To represent a floating-point number 14.765467 in Q8.24 format, the
equivalent fixed-point number would be 14.765467 x 2<sup>24</sup> =
247723429.2 which rounds to 247723429.</p>
<p>To get back the floating-point number given the Q8.24 number 247723429,
calculate 247723429 ÷ 2<sup>24</sup> and get back the floating-point
number as 14.76546699. The difference of 0.00000001 is correct to with
the error bounds of ±2<sup>-25</sup> which is ±0.00000003</p>
</div>
</div>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="Flash_programming_flow.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Flash programming and update flow</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="General_purpose_filter_example.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">General purpose filter example</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2019-2021, XMOS Ltd
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="../../../_sources/doc/rst/reference/Control_parameter_protocol.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Command transport protocol</a><ul>
<li><a class="reference internal" href="#transport-protocol-for-control-parameters">Transport protocol for control parameters</a></li>
<li><a class="reference internal" href="#transporting-control-parameters-over-i2c">Transporting control parameters over I2C</a></li>
<li><a class="reference internal" href="#transporting-control-parameters-over-usb">Transporting control parameters over USB</a></li>
<li><a class="reference internal" href="#floating-point-to-fixed-point-q-format-conversion">Floating point to fixed point (Q format) conversion</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/tabs.js"></script>
    <script src="../../../_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>